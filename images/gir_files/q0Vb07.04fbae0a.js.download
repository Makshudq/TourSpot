(this.$WP=this.$WP||[]).push(["q0Vb07",(e,t)=>{"use strict";var i,r,n,a,l,o,c,s,d,u,m,p,v,g,T,h,C,_,k,y,b,E,f,P,S,I,R,D,A,G,w,O,N,x,L,B,F,K,U,M,W,z,V,j,Y,J,q,H,Q,$,Z,X,ee,te,ie,re,ne,ae,le,oe,ce,se,de,ue,me,pe,ve,ge,Te,he,Ce,_e,ke,ye,be,Ee,fe,Pe,Se,Ie,Re,De,Ae,Ge,we,Oe,Ne,xe,Le,Be,Fe,Ke,Ue,Me,We,ze,Ve,je,Ye,Je,qe,He,Qe,$e,Ze,Xe,et,tt,it,rt,nt,at,lt,ot,ct,st=()=>{var e="MOBILE"===s();return ee("div",{children:[X(b,{variant:"title-01",children:X(V,{id:"fusion_generic_error_title"})}),X(b,{variant:"body-01",marginTop:"spacing-04",marginBottom:"spacing-05",children:X(V,{id:"fusion_generic_error_message"})}),X(g,{onClick:()=>window.location.reload(),fullWidth:e,children:X(V,{id:"fusion_generic_error_reload_cta"})})]})},dt=({ticket:e,addDivider:t})=>{var{onSelectTicket:i}=f(),{trackClick:r}=S(),n=le({internalLink:e.productDetailsLink}),a=null!=e.labels&&e.labels.length>0&&X(W,{model:e.labels});return ee("div",{children:[null!=a&&X("div",{className:"vubpL",children:a}),X(I,{href:n.url,children:X(b,{variant:"title-04",marginBottom:"spacing-01",children:e.name})}),null!=e.reviewCount&&e.reviewCount>0&&null!=e.reviewRating&&X(re,{numReviews:e.reviewCount,rating:e.reviewRating,size:"small",marginBottom:"spacing-02"}),null!=e.description&&X(ne,{variant:"minimal",children:X(I,{href:n.url,children:X("span",{dangerouslySetInnerHTML:{__html:e.description}})})}),ee("div",{className:"f k u Ml",children:[e.price&&X(I,{href:n.url,children:X(b,{variant:"title-05",children:X(z,{model:e.price})})}),X(g,{variant:"commerce",size:"medium",onClick:()=>{i(e),r({clientContext:"selectTicket",clientParameter:e.name})},dataAttributes:{"data-automation":"poi-ticket-commerce"},children:X(V,{id:"exp_check_availability"})})]}),t&&X(ae,{marginY:"spacing-04"})]})},ut=({model:e})=>{var{onSelectTicket:t}=f(),{trackClick:i}=S();return r((()=>{var r,n,a;1===(null==(r=e.tickets)?void 0:r.length)&&e.tickets[0]&&(t(e.tickets[0],!0),i({clientContext:"selectTicket",clientParameter:null==(n=e.tickets)||null==(a=n[0])?void 0:a.name}))}),[t,e.tickets,i]),X("div",{children:e.tickets&&e.tickets.length>1&&e.tickets.filter(Boolean).map(((e,t,i)=>X(dt,{ticket:e,addDivider:t<i.length-1},t)))})},mt=e=>{var t;return!(null!=(t=e.startTimes)&&t.length||!e.available)},pt=e=>{var t;return!(null==(t=e.startTimes)||!t.some((e=>"AvailableTimedEntryOption"===(null==e?void 0:e.entryType))))},vt=e=>{var t;return null==(t=e.startTimes)?void 0:t.find((e=>"AvailableTimedEntryOption"===(null==e?void 0:e.entryType)))},gt=e=>e.some((e=>"AvailableTimedEntryOption"===(null==e?void 0:e.entryType))),Tt=({trackingKey:e,plusBundlingProps:t})=>{var[i]=n(_e()),r=me(),{cashbackEnabled:a}=ke(),l=Ce(),{cashbackDisplayAmount:o}=he(t),c=void 0!==o,[s,d]=n(!1);return a&&l&&c?ee(b,{variant:"title-05",marginRight:"spacing-01",color:"accentPurpleText",marginTop:"spacing-01",children:[X(h,{variant:"accent",onClick:()=>{r({actionSubType:"optimusExperiencesCashbackClick",actionType:"click",impressionKey:i,itemType:"howToEarn",customData:{flow:"ExperiencesCheckout",isSubscriber:!0,trackingKey:e}}),d(!0)},children:X("div",{className:"suAYV",children:X(V,{id:"plus_tour_grade_get_paid_v2",args:{0:o||""}})})}),s&&X(Te,{variant:"steps",onClose:()=>{d(!1)},getFunnelKeyByToken:t=>t(e),cashbackDisplayAmount:o,showCloseButton:!1})]}):null},ht=e=>e.filter(Boolean).filter((e=>null!=e.startTime)).map((e=>{var t=e.startTime||"",i="UnavailableTimedEntryOption"===e.entryType;return{chipContent:X("div",{className:v({Yvque:i}),children:t}),disabled:i,keyValue:t}})),Ct=({model:e,currentTourGrade:t})=>{var i,{trackClick:r}=S(),o=s(),{selectedTourGrade:c,onSelectTourGrade:d}=f(),u=(null==c?void 0:c.tourGrade)===t?null==c||null==(i=c.timedEntry)?void 0:i.startTime:null,m=a((()=>"MOBILE"===o?3:6),[o]),p=a((()=>ht(e.slice(0,m))),[m,e]),v=a((()=>ht(e.slice(m))),[m,e]),g=a((()=>(e=>{var t=new Map;return e.filter(Boolean).filter((e=>null!=e.startTime)).forEach((e=>{var i=e.startTime||"";t.set(i,e)})),t})(e)),[e]),T=l(((e,i,n)=>{var a;n.stopPropagation(),d({tourGrade:t,timedEntry:g.get(e)}),r({clientContext:"selectTour",clientParameter:`${(null==(a=t.title)?void 0:a.text)||""} ${e}`})}),[t,g,d,r]),C=gt(e)&&!gt(e.slice(0,m)),[_,k]=n(C),y=ee("div",{className:"f u",children:[X(V,{id:"attractions.see.more.times"})," ",X(Ee,{})]}),E=ee("div",{className:"f u",children:[X(V,{id:"attractions.see.fewer.time"})," ",X(fe,{})]}),P=e=>{var i;e.stopPropagation(),r({clientContext:_?"collapseTimedEntries":"expandTimedEntries",clientParameter:`${(null==(i=t.title)?void 0:i.text)||""}`}),k((e=>!e))};return ee("div",{className:"Mk",children:[X(be,{chipsData:p,onChange:T,selectedValue:u,variant:"button"}),0!==v.length&&ee(te,{children:[!_&&X(b,{variant:"body-01",marginY:"spacing-02",children:X(h,{variant:"primary",onClick:P,children:y})}),_&&ee(te,{children:[X(be,{chipsData:v,onChange:T,selectedValue:u,variant:"button"}),X(b,{variant:"body-01",marginY:"spacing-02",children:X(h,{variant:"primary",onClick:P,children:E})})]})]})]})},_t="Hbnyp",kt="yQEaD Gs u MI",yt=(e,t)=>{var i,r;return null!=t?`${(null==(i=e.title)?void 0:i.text)||""} ${t.startTime||""}`:null==(r=e.title)?void 0:r.text},bt=({model:e})=>{var t,i,r,n,{trackClick:c}=S(),{funnelKey:s}=o(ge),{selectedTourGrade:d,onSelectTourGrade:u}=f(),{startTimes:m}=e,p=a((()=>vt(e)),[e]),v=pe(),g=me(),T=p&&"detailedPrice"in p?p.detailedPrice:null,h=p&&"totalPrice"in p?p.totalPrice:null,C=p&&"disclaimerText"in p?p.disclaimerText:null,_=null!=(t=e.detailedPrice)&&t.length?e.detailedPrice:T,k=e.totalPrice||h,y=e.disclaimerText||C,E=(null==(i=e.rnplEligibility)?void 0:i.isEligible)||p&&"rnplEligibility"in p&&(null==(r=p.rnplEligibility)?void 0:r.isEligible)||!1,P=a((()=>mt(e)||pt(e)),[e]),I=(null==d?void 0:d.tourGrade)===e,{plusBundlingProps:R}=e,{isEligibleForBundling:D}=ue(R),A=l((()=>{D&&v({impressionKey:s,itemName:"TourGrade",itemType:"optimusExperiencesCashbackTag",customData:{flow:"ExperiencesCheckout",gbv:k,tourGrade:e}})}),[v,s,D,e,k]),G=de(A),w=l((()=>{P&&(I&&null!=d&&d.timedEntry||(u({tourGrade:e,timedEntry:p}),c({clientContext:"selectTour",clientParameter:yt(e,p)}),D&&g({itemType:"OptimusCashbackTourGradeSelection",actionSubType:"optimusExperiencesCashback",actionType:"click",impressionKey:s,customData:{flow:"ExperiencesCheckout",gbv:k,tourGrade:e}})))}),[e,p,I,P,d,u,c,g,s,k,D]),O=a((()=>null!=m&&m.length>0&&X(qe,{model:m,currentTourGrade:e})),[m,e]);return ee("div",{onClick:w,className:H("ORwKL B2 Z BC z",{nZpcR:I,hFhea:P,[_t]:D}),ref:G,children:[D&&X(b,{variant:"supporting-01",color:"invertText",children:X("div",{className:H(kt,"FKxJc"),children:X(V,{id:"exp_bundle_info_card_free_membership_included"})})}),ee("div",{className:"eBrZK k",children:[ee("div",{className:H("WKmDZ",{[_t]:D}),children:[ee("div",{className:"zvvPz k",children:[e.title&&X(b,{variant:"title-04",marginBottom:"spacing-02",children:X(z,{model:e.title})}),D&&X(b,{variant:"supporting-01",color:"invertText",children:X("div",{className:H(kt,"BVuOu"),children:X(V,{id:"exp_bundle_info_card_free_membership_included"})})})]}),E&&X(se,{variant:"secondary",marginBottom:"spacing-02",children:X(V,{id:"attractions_rnpl_eligible"})}),P&&null!=e.description&&e.description&&X(ne,{variant:"minimal",children:X(b,{variant:"supporting-01",children:X("span",{dangerouslySetInnerHTML:{__html:e.description}})})}),_&&X(b,{variant:"supporting-02",marginTop:"spacing-02",children:_.filter(Boolean).map(((e,t)=>X("div",{children:X(z,{model:e})},t)))}),k&&ee(te,{children:[X(b,{variant:"title-05",display:"inline-block",marginRight:"spacing-01",marginTop:"spacing-02",children:X(z,{model:k})}),y&&X(b,{variant:"supporting-02",elementType:"span",display:"inline-block",children:X(z,{model:y})})]}),null!==R&&X(Je,{trackingKey:s,plusBundlingProps:R}),ee("div",{className:"OPQUQ",children:[" ",O," "]})]}),P&&X("div",{className:"wmkpp",children:X(oe,{onSelect:w,selected:I,value:e.trackingTitle+(null!=(n=yt(e,p))?n:"")})})]}),X("div",{className:H("GevCP",{[_t]:D}),children:O})]})},Et=({model:e})=>{var{onSelectTourGrade:t}=f(),{trackClick:i}=S();return r((()=>{var r=(e=>{var t;return null==(t=e.tourGrades)?void 0:t[0]})(e);if(null!=r&&(mt(r)||pt(r))){var n,a,l=vt(r);t({tourGrade:r,timedEntry:l});var o=null!=l?`${(null==(n=r.title)?void 0:n.text)||""} ${l.startTime||""}`:null==(a=r.title)?void 0:a.text;i({clientContext:"selectTour",clientParameter:o})}}),[e,t,i]),r((()=>{var t;0===(null==(t=e.tourGrades)?void 0:t.length)&&i({clientContext:"noAvailableTourGrades"})}),[e,i]),e.summary||e.tourGrades?ee("div",{children:[e.summary&&X(b,{variant:"body-01",marginTop:"spacing-04",marginBottom:"spacing-04",children:X(z,{model:e.summary})}),e.tourGrades&&X(ce,{name:"tour_grades",children:X("div",{className:"gNvPK A",children:e.tourGrades.filter(Boolean).map(((e,t)=>X(He,{model:e},t)))})})]}):null},ft=({section:e,update:t})=>{switch(e.__typename){case"WebPresentation_PoiTickets":return X(Ye,{model:e});case"WebPresentation_TourGradesDetail":return X(Qe,{model:e});case"WebPresentation_ChipCardCarousel":return X(ie,{model:e,update:t});case"WebPresentation_DisclaimerSection":case"WebPresentation_TourGradesHeaderWeb":return null;default:return X(D,{typename:e})}},Pt=({model:e,update:t})=>{var{sections:i}=e;return i&&X(te,{children:i.map(((e,i)=>e&&X(ft,{section:e,update:t},i)))})},St=({result:e,fetching:t,polling:i,update:r,duplicateItemError:n})=>{var{localize:a}=j();return ee("div",{children:[(t||i)&&X("div",{className:"f u j Mm",children:X(Z,{variant:"large","aria-label":a.string("fusion_attraction_commerce_loading")})}),!(t||i)&&e&&ee(te,{children:[n&&X(b,{variant:"supporting-02",color:"dangerText",marginTop:"spacing-03",children:a("already_added_to_cart")}),X($e,{model:e,update:r})]})]})},It=({trackingKey:e,subscribed:t})=>{var{funnelKey:i}=o(ge),r=Ce();return X(ve,{itemName:"OptimusBundlingTourGradeBanner",itemType:"optimusBanner",impressionKey:i,customData:{flow:"ExperiencesCheckout",isSubscriber:r,trackingKey:e},children:ee("div",{className:"NAPqh Pj PX Pw PJ ML Gs u",children:[X("span",{className:"tELTG Nk",children:X(Re,{variant:"plus-logo-short-white",height:24})}),X(b,{elementType:"span",variant:"body-01",color:"onDarkText",children:X(Y,t?{id:"plus_tour_grade_banner_title_subscribed"}:{id:"plus_tour_grade_banner_title"})})]})})},Rt=({trackingKey:e})=>{var t=ye(),i=Ce(),r=De();return i&&r||t?X(It,{trackingKey:e,subscribed:i}):null},Dt=e=>"WebPresentation_TourGradesHeaderWeb"===(null==e?void 0:e.__typename),At=({result:e,renderPickerFlow:t,trackingKey:i})=>{var r,n=null==e||null==(r=e.sections)?void 0:r.find(Dt);return Dt(n)?X(Gt,{model:n,renderPickerFlow:t,trackingKey:i}):null},Gt=({model:e,renderPickerFlow:t,trackingKey:i})=>{var{setTicketInfo:n}=f(),{datePicker:l,freeCancellationMessage:o,productName:c,productDescription:s,tags:d,labels:u,noCommerceMessage:m}=e;r((()=>{var e,t=Pe(l);t&&((null==(e=t.passengerInfo)?void 0:e.ageBands)||[]).length>0&&null!=c&&null!=s&&null!=u?n(t,{name:c,description:s,labels:u}):console.error("[Fusion] TourGradesHeaderWeb missing key data, AttractionCommerceModal will be missing header.")}),[l,c,s,u,n]);var p=a((()=>null!==o?X(Se,{model:o}):null!==d?X(Ie,{model:d}):null),[o,d]);return ee(te,{children:[null!=p&&X("div",{className:$({marginTop:"spacing-03",marginBottom:"spacing-03"}),children:p}),X(Xe,{trackingKey:i}),t(),m&&X(b,{variant:"supporting-02",color:"dangerText",marginTop:"spacing-03",children:X(z,{model:m})})]})},wt=(e,t)=>{var i;switch(t.type){case"SELECT_TICKET":return{...e,ticketLink:null==(i=t.ticket)?void 0:i.linkV2,singleTicket:t.singleTicket,step:"TOURGRADES",isDuplicateItemError:!1};case"SELECT_TOUR":return{...e,selectedTourGrade:t.tour,isDuplicateItemError:!1};case"START_BOOKING":return{...e,isBooking:!0,isDuplicateItemError:!1};case"ADD_TO_CART":return{...e,isAddingToCart:!0,isDuplicateItemError:!1};case"ADD_TO_CART_SUCCESS":return{...e,isAddingToCart:!1};case"SET_TICKET_INFO":return e.datePickerConfig===t.datePickerConfig?e:{...e,datePickerConfig:t.datePickerConfig,ticketInfo:t.ticketInfo,isDuplicateItemError:!1};case"BACK":return{step:"TICKETS",isBooking:!1,isAddingToCart:!1,isDuplicateItemError:!1};case"ERROR":return{step:"GENERIC_ERROR",isBooking:!1,isAddingToCart:!1,isDuplicateItemError:!1};case"DUPLICATE_ITEM_ERROR":return{...e,isBooking:!1,isAddingToCart:!1,isDuplicateItemError:!0};default:return console.error("Unhandled action",t),e}},Ot=({initialStep:e="TICKETS",link:t=null})=>c(wt,{step:e,ticketLink:t,isBooking:!1,isAddingToCart:!1,isDuplicateItemError:!1}),Nt={__key:0xe8f9bd2a846b,id:"e8f9bd2a846b71d3ce4b52f2a3437f74",loc:{},definitions:[]},xt=(e,t,r=!1)=>{return n=Ae({query:Nt,variables:i.useMemo((()=>({...e,request:{...e.request,updateToken:t}})),[e,t]),pause:r}),i.useMemo((()=>{var e,[t,i]=n;return[{...t,data:null==(e=t.data)?void 0:e.Result,operation:void 0},i]}),[n]);var n},Lt=({contentId:e,contentType:t,state:r,customDate:n})=>{var a,{state:{currency:l,unitLength:o,commerce:c}}=O(),{trackClick:s}=S({clientContext:"attractionCommerceQuery"}),{attractions:{adults:d}}=Ge(),u=n||(null==c||null==(a=c.attractionCommerce)?void 0:a.setByUser);i.useEffect((()=>{var e,t,i={date:{isDefault:!u,value:n||(null==c||null==(e=c.attractionCommerce)?void 0:e.startDate)||""},pax:{isDefault:null==d||0===d,value:(null==c||null==(t=c.attractionCommerce)?void 0:t.pax)||[]}};s({clientParameter:JSON.stringify(i)})}),[u,d,null==c?void 0:c.attractionCommerce,s,n]);var m=null!=n?N(n):"",p=i.useMemo((()=>{var i,n;return{unitLength:o,currency:l,request:{routeParameters:{contentId:e,contentType:t,state:r}},commerce:{...c,attractionCommerce:{...null==c?void 0:c.attractionCommerce,startDate:m||(null==c||null==(i=c.attractionCommerce)?void 0:i.startDate),endDate:m||(null==c||null==(n=c.attractionCommerce)?void 0:n.endDate)}}}}),[l,o,e,t,r,c,m]);return it(p)},Bt="SBCRl f",Ft="RESULT_STATUS_DUPLICATE_ITEM",Kt=(e,t)=>new Promise(((i,r)=>{var n=a=>{fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:t,credentials:"same-origin"}).then((e=>e.ok?e.json():r(new Error("NOT_OK")))).then((e=>{switch(e.polling_state){case"COMPLETE":if(!e.result)throw new Error("NO_RESULT");return(e=>{switch(e.status){case"SUCCESS":return e.cart?Promise.resolve(e.cart):Promise.reject(new Error("STATUS_COMPLETE_SUCCESS_NO_CART"));case"DUPLICATE_ITEM":return"DUPLICATE_ITEM"===(null==(t=e.notification)?void 0:t.notificationType)&&null!=(null==t?void 0:t.notificationId)?Fe([null==t?void 0:t.notificationId]).catch((()=>Promise.reject(new Error("FAIL_DELETE_NOTIFICATION")))).then((()=>Promise.reject(new Error(Ft)))):(console.error("[Fusion][Availability] ","NO_DUPLICATE_ITEM_ACTION"),Promise.reject(new Error(Ft)));case"ITEM_NOT_AVAILABLE":case"IN_PROGRESS":case"FAILED":default:return Promise.reject(new Error(`RESULT_STATUS_${e.status}`))}var t})(e.result).then(i);case"IN_PROGRESS":if(a<30)return setTimeout((()=>n(a+1)),1e3),null;throw new Error("REACH_MAX_POLL_COUNT");case"ERROR":default:throw new Error("FETCH_ERROR")}})).catch(r)};return n(1)}));function Ut(){var e=Oe(),t=we(),{funnelKey:i}=o(ge),{setCartCount:r}=d(),n=l(((i,n,a,l)=>{var o,c;a({type:"ADD_TO_CART"}),n({clientContext:"addToCart"});var s=null==i||null==(o=i.tourGrade)?void 0:o.webviewCheckout,d="WebPresentation_AvailableTimedEntryOption"===(null==i||null==(c=i.timedEntry)?void 0:c.__typename)?i.timedEntry.webviewCheckout:s,{addToCartPayload:u,addToShoppingCartUrl:m}=d||{};return null!=m&&u?Kt(m,u).then((i=>{var n,a=(null==(n=i.items)?void 0:n.length)||1;return r(a),Ne(t,e,a),((e,t)=>{try{var{productCode:i,tourGradeCode:r,tourDate:n,passengerMix:a}=JSON.parse(t);if(i&&r&&n&&a){var l=Le(i,r,n,JSON.stringify(a));Be(e,!1,l)}}catch(e){console.error("[Fusion][Availability] Failed to parse cart payload for abandoned cart popup")}})(t,u),i.items})).catch((e=>{var t,{productCode:i,tourGradeCode:r}=JSON.parse(u);return"RESULT_STATUS_DUPLICATE_ITEM"===(null==e?void 0:e.message)?(a({type:"DUPLICATE_ITEM_ERROR"}),t="addToCartDuplicateItem"):(l(),console.error("[Fusion][Availability]",e.message),t="addToCartError"),n({clientParameter:t,trackingTitle:e.message,trackingKey:JSON.stringify({apc:i,atg:r})}),Promise.reject()})).finally((()=>a({type:"ADD_TO_CART_SUCCESS"}))):(console.error("[Fusion][Availability] there was no valid addToShoppingCartUrl, addToCartPayload"),n({clientContext:"error_noValidAddToShoppingCartUrl"}),Promise.reject(new Error("Missing add to cart data")))}),[t,e,r]),c=l(((e,r,n,a)=>{var l,o;n({type:"START_BOOKING"}),r({clientContext:"bookTour"});var c=null==e||null==(l=e.tourGrade)?void 0:l.webviewCheckout,s="WebPresentation_AvailableTimedEntryOption"===(null==e||null==(o=e.timedEntry)?void 0:o.__typename)?e.timedEntry.webviewCheckout:c,{addToCartUrl:d,addToCartPayload:u,checkoutUrl:m}=s||{},p=null!=m&&((e,t)=>{var[i,r]=e.split("?"),n=new URLSearchParams(r);return null!==t&&n.set("oik",t),`${i}?${n.toString()}`})(m,i);null!=d&&u&&p?Kt(d,u).then((()=>{((e,t)=>{try{var{productCode:i,tourGradeCode:r}=JSON.parse(t);i&&r&&xe(e,i,r,!1)}catch(e){console.error("[Fusion][Availability] Failed to parse checkout payload for abandoned checkout popup")}})(t,u),window.location.href=p})).catch((e=>{a(),console.error("[Fusion][Availability]",e.message);var{productCode:t,tourGradeCode:i}=JSON.parse(u);r({clientParameter:"addToCartlessError",trackingTitle:e.message,trackingKey:JSON.stringify({apc:t,atg:i})})})):(console.error("[Fusion][Availability] there was no valid addToCartUrl, addToCartPayload"),r({clientContext:"error_noValidAddToCartUrl"}))}),[i,t]);return a((()=>({addTourGradeToCart:n,bookTourGrade:c})),[n,c])}var Mt=({result:e})=>{if(!e)return null;var{sections:t}=e;return t?X(te,{children:t.map(((e,t)=>e&&"WebPresentation_DisclaimerSection"===e.__typename?X("div",{className:"ylJXV",children:X(M,{model:e})},t):null))}):null},Wt=()=>B(localStorage.getItem("AttractionListCommerceStartDate")),zt=({datePickerConfig:e,children:t,clearTourGrade:i,setFusionDates:r,priceDescription:n,isListPage:o})=>{var{singleDate:c,setSingleDate:d,isDefaultDates:u}=L(r),{pax:m,setPax:p}=F(),v=s(),T=l((e=>{var t;"MOBILE"!==v&&(null==(t=e.ref.current)||t.scrollIntoView())}),[v]),h=l(((e,t,r=!0)=>{i(),d(e,t,r&&!o)}),[i,d,o]),C=l(((...e)=>{i(),p(...e)}),[i,p]),_=a((()=>null!=e&&e.priceCalendar&&e.priceCalendar.length>0?new Set(e.priceCalendar.map((e=>null==e?void 0:e.date)).filter(Boolean)):void 0),[null==e?void 0:e.priceCalendar]),k=a((()=>{var t=new Map;return null!=e&&e.priceCalendar&&e.priceCalendar.forEach((e=>{var i;null!=(null==e?void 0:e.date)&&null!=(null==(i=e.price)?void 0:i.text)&&t.set(e.date,e.price.text)})),t}),[null==e?void 0:e.priceCalendar]),y=K({date:(()=>{if(o){var e=Wt();if(e)return e}return c})(),setDate:h,availableDates:_,showFooterDescription:!0,isDefaultDates:u&&!o,priceMap:k}),b=U({passengerInfo:null==e?void 0:e.passengerInfo,currentPax:m,setPax:C,showApplyButton:!1}),E=a((()=>[y,b]),[y,b]),f=l((({onClick:e,disabled:t})=>X(g,{disabled:t,size:"small",variant:"commerce",onClick:e,children:X(V,{id:"phoenix_product_attractions_check_availability_btn"})})),[]);return X(x,{autoAdvance:!1,pickers:E,onOpen:T,inline:!0,renderApplyButton:f,pickerFooter:n,children:t})},Vt=({onClose:e,setFusionDates:t,initialStep:i="TICKETS",link:n=null,contentId:a,isRnplEligible:o=!1,trackingKey:c="",onAddToCart:d,isListPage:u=!1})=>{var{localize:m}=j(),[p,T]=tt({initialStep:i,link:n}),f=s(),{trackClick:P}=S(),{singleDate:I}=L(t),{step:R,ticketLink:D,singleTicket:A,ticketInfo:G,selectedTourGrade:w,datePickerConfig:O,isBooking:N,isAddingToCart:x,isDuplicateItemError:B}=p,F=J("IB_CLICK");r((()=>{F()}),[F]);var K,U,M,Y="TICKETS"===i&&!A,q="MOBILE"===f,H=l(((e,t=!1)=>{T({type:"SELECT_TICKET",ticket:e,singleTicket:t})}),[T]),Q=l(((e,t)=>{T({type:"SET_TICKET_INFO",datePickerConfig:e,ticketInfo:t})}),[T]),$=l((e=>{T({type:"SELECT_TOUR",tour:e})}),[T]),Z=l((()=>$(null)),[$]),ie=l((()=>{T({type:"ERROR"}),P({clientContext:"errorScreen"})}),[T,P]),re=l((()=>{P({clientContext:"RNPLCopy",clientParameter:"learnMoreClick"})}),[P]),{addTourGradeToCart:ne,bookTourGrade:ae}=Ut(),le=()=>{ne(w,P,T,ie).then((t=>{null==d||d(t),null==e||e()})).catch((()=>{}))},oe=()=>{ae(w,P,T,ie)},ce=X(b,{variant:"button-04",elementType:"span",marginLeft:"spacing-01",children:X(k,{href:"https://www.tripadvisorsupport.com/hc/en-us/articles/360039125133-Reserve-Now-Pay-Later",theme:"inline",target:"_blank",onClick:re,children:X(V,{id:"fusion_reserve_now_pay_later_notice_cta"})})}),se=null!=O&&O.priceDescription?X(z,{model:O.priceDescription}):null,de=u?Wt():I;if("TICKETS"===R)({contentId:K,contentType:U,state:M}={contentId:a,contentType:"attraction",state:"tickets"});else if("TOURGRADES"===R){var ue,me;"Routing_AttractionCommerceParameters"===(null==D||null==(ue=D.webRoute)||null==(me=ue.typedParams)?void 0:me.__typename)&&({contentId:K,contentType:U,state:M}=D.webRoute.typedParams)}var[{data:pe,fetching:ve,polling:ge,error:Te},he]=rt({contentId:K,contentType:U,state:M,customDate:de});return r((()=>{Te&&(console.error("[Fusion][Availability] attraction commerce query resulted in an error",Te.message),ie())}),[Te,ie]),X(E.Provider,{value:{onSelectTicket:H,setTicketInfo:Q,selectedTourGrade:w,onSelectTourGrade:$,setFusionDates:t,clearTourGrade:Z},children:X(zt,{datePickerConfig:O,setFusionDates:t,clearTourGrade:Z,priceDescription:se,isListPage:u,children:({renderPickerFlow:t,currentPicker:i,closePicker:r})=>{var n,a,l,s,d=()=>{!i&&Y&&T({type:"BACK"}),r(),P({clientContext:"back"})},u=!q&&null==i&&"TOURGRADES"===R&&Y,p=q&&"TOURGRADES"===R&&Y,k=null!=w&&w.tourGrade&&"rnplEligibility"in w.tourGrade?null==w?void 0:w.tourGrade.rnplEligibility:null,E=null!=w&&w.timedEntry&&"rnplEligibility"in w.timedEntry?w.timedEntry.rnplEligibility:null,f=o&&(null==(n=E||k)?void 0:n.isEligible)||!1,S=u?X(h,{onClick:d,disabled:N||x,children:X(V,{id:"phoenix_back"})}):void 0;"TOURGRADES"===R&&(l=!q&&null!=se&&"date"===(null==i?void 0:i.name)&&se,q||"date"!==(null==i?void 0:i.name)&&"pax"!==(null==i?void 0:i.name)?(a=X(g,{onClick:oe,variant:"commerce",disabled:!w||N||x||B,loading:N,dataAttributes:{"data-automation":"attractions-commerce-modal-primary"},"aria-label":m.string("fusion_attraction_commerce_booking"),children:X(V,{id:"attractions_booking_reserve_now"})}),s=X(Ve,{onClick:le,disabled:!w||N||x||B,loading:x,"aria-label":m.string("fusion_attraction_commerce_booking"),fullWidth:q,marginRight:"spacing-03",children:X(V,{id:"attractions_add_to_cart_cta"})})):a=X(g,{dataAttributes:{"data-automation":"attractions-commerce-modal-primary"},onClick:()=>{P({clientContext:"checkAvailability"}),null==i||i.onApply(),r()},children:X(V,{id:"phoenix_product_attractions_check_availability_btn"})}));var I,D=f?ee(b,{variant:"supporting-01",elementType:"span",display:"inline-block",marginTop:"spacing-03",children:[X(V,{id:"attractions_rnpl_eligible_v2"}),"Â ",X(V,{id:"attractions_rnpl_disclaimer_reserve_now"}),ce]}):null;switch(R){case"TICKETS":I=m.string("phoenix_poi_attractions_tickets_tab");break;case"TOURGRADES":I=null==G?void 0:G.name;break;default:I=null}var A=(null==G?void 0:G.labels)&&G.labels.length>0&&X(W,{model:G.labels});return X(y,{variant:"fixed-height-sticky-footer",heightOption:"restricted-full",footer:(null!=l||null!=a||null!=s)&&X("div",{className:"FPRSV",children:ee("div",{className:v("YCrWp f"),children:[S&&X("div",{className:Bt,children:S}),null!=l&&X("div",{className:Bt,children:l}),ee("div",{className:v(Bt,"CYcyQ"),children:[X("div",{children:s}),X("div",{children:a})]})]})}),backButton:p?X(C,{onClick:d,disabled:N||x,icon:_,size:"small","aria-label":m.string("phoenix_back")}):void 0,onClose:N||x?void 0:e,children:ee("div",{className:v("qSYVO",{"CpuBS S":N||x}),children:[null!=A&&X("div",{className:"xyGVT",children:A}),null!=I&&X(b,{variant:"title-02",marginBottom:"spacing-02",children:I}),"TOURGRADES"===R&&X(et,{result:pe,trackingKey:c,renderPickerFlow:null!=O&&O.passengerInfo?t:()=>null}),"GENERIC_ERROR"!==R&&ee(te,{children:[X("div",{className:i?"_T Xd o U":"",children:X(Ze,{fetching:ve,polling:ge,result:pe,update:he,duplicateItemError:B})}),!(ve||ge)&&ee(te,{children:[X(Mt,{result:pe}),D]})]}),"GENERIC_ERROR"===R&&X(je,{})]})})}})})},jt=({model:e})=>{var{setTicketInfo:t}=f(),{datePicker:i,productName:n,productDescription:a,labels:l,noCommerceMessage:o,freeCancellationMessage:c}=e,s=Pe(i);return r((()=>{var e;s&&((null==(e=s.passengerInfo)?void 0:e.ageBands)||[]).length>0&&null!=n&&null!=a&&null!=l?t(s,{name:n,description:a,labels:l}):console.error("[Fusion] TourGradesHeaderWeb missing key data, AttractionCommerceModal will be missing header.")}),[s,n,a,l,t]),ee(te,{children:[c?ee("div",{className:"DZFNa f _Y MK",children:[X(Ue,{size:12}),X(b,{variant:"input-03",color:"secondaryText",elementType:"span",children:X(Se,{model:c})})]}):null,X(Me,{datePickerConfig:s}),X(ae,{marginTop:"spacing-03"}),o&&X(b,{variant:"supporting-02",color:"dangerText",marginTop:"spacing-03",children:X(z,{model:o})})]})},Yt=()=>{var{fullFAQLink:e}=We(),{trackClick:t}=S(),i=l((()=>{t({clientContext:"RNPLCopy",clientParameter:"learnMoreClick"})}),[t]),{selectedTourGrade:r}=f(),n=null!=r&&r.tourGrade&&"rnplEligibility"in r.tourGrade?null==r?void 0:r.tourGrade.rnplEligibility:null,a=null!=r&&r.timedEntry&&"rnplEligibility"in r.timedEntry?r.timedEntry.rnplEligibility:null;return(null==a?void 0:a.isEligible)||(null==n?void 0:n.isEligible)?ee(b,{variant:"supporting-01",elementType:"span",display:"inline-block",marginTop:"spacing-03",children:[X(V,{id:"experiences_rnpl_eligible_message"}),X(b,{variant:"button-04",elementType:"span",marginLeft:"spacing-01",children:X(k,{href:e,theme:"inline",target:"_blank",onClick:i,children:X(V,{id:"fusion_reserve_now_pay_later_notice_cta"})})})]}):null},Jt=e=>"WebPresentation_TourGradesHeaderWeb"===(null==e?void 0:e.__typename),qt=e=>"WebPresentation_PoiTickets"===(null==e?void 0:e.__typename),Ht=e=>"WebPresentation_TourGradesDetail"===(null==e?void 0:e.__typename),Qt=e=>"WebPresentation_ChipCardCarousel"===(null==e?void 0:e.__typename),$t=e=>"WebPresentation_DisclaimerSection"===(null==e?void 0:e.__typename),Zt=({result:e,update:t,fetching:i,polling:r,duplicateItemError:n})=>{var a,l,o,c,s,{localize:d}=j(),u=null==e||null==(a=e.sections)?void 0:a.find(Jt),m=null==e||null==(l=e.sections)?void 0:l.find(Ht),p=null==e||null==(o=e.sections)?void 0:o.find(Qt),v=null==e||null==(c=e.sections)?void 0:c.find($t),g=null==e||null==(s=e.sections)?void 0:s.find(qt);return ee(te,{children:[u&&X(at,{model:u}),(i||r)&&X("div",{className:"gQRyR f u j",children:X(Z,{variant:"large","aria-label":d.string("fusion_attraction_commerce_loading")})}),!(i||r)&&ee(te,{children:[n&&X(b,{variant:"supporting-02",color:"dangerText",marginTop:"spacing-03",children:d("already_added_to_cart")}),g&&X(Ye,{model:g}),p&&ee(te,{children:[X("div",{className:"ickWP",children:X(ie,{model:p,update:t})}),X(ae,{})]}),m&&X(Ke,{model:m}),v&&X("div",{className:"QYneg",children:X(M,{model:v})}),X(lt,{})]})]})},Xt=({onClose:e,setFusionDates:t,initialStep:i="TICKETS",contentInfo:n,onAddToCart:a,useDateFromLocalStorage:o=!1})=>{var{localize:c}=j(),{trackClick:d}=S(),p="MOBILE"===s(),{singleDate:T}=L(t),[h,C]=tt({initialStep:i}),[,_]=u(),[,k]=m();r((()=>{p?_():k()}),[p,k,_]);var{step:f,ticketInfo:P,ticketLink:I,selectedTourGrade:R,isAddingToCart:D,isBooking:A,isDuplicateItemError:G}=h,w=J("IB_CLICK");r((()=>{w()}),[w]);var O,N=l(((e,t=!1)=>{C({type:"SELECT_TICKET",ticket:e,singleTicket:t})}),[C]),x=l(((e,t)=>{C({type:"SET_TICKET_INFO",datePickerConfig:e,ticketInfo:t})}),[C]),F=l((e=>{C({type:"SELECT_TOUR",tour:e})}),[C]),K=l((()=>F(null)),[F]),U=l((()=>{C({type:"ERROR"}),d({clientContext:"errorScreen"})}),[C,d]),{addTourGradeToCart:M,bookTourGrade:Y}=Ut();switch(f){case"TICKETS":O=c.string("phoenix_poi_attractions_tickets_tab");break;case"TOURGRADES":O=null==P?void 0:P.name;break;default:O=null}var q,H=(null==P?void 0:P.labels)&&P.labels.length>0&&X(W,{model:P.labels});if("TOURGRADES"===f){var Q,$,Z=X(g,{onClick:()=>{Y(R,d,C,U)},variant:"commerce",disabled:!R||A||D||G,loading:A,fullWidth:p,dataAttributes:{"data-automation":"attractions-commerce-modal-primary"},"aria-label":c.string("fusion_attraction_commerce_booking"),children:X(V,{id:"attractions_booking_reserve_now"})}),te=X(Ve,{onClick:()=>{M(R,d,C,U).then((t=>{null==a||a(t),null==e||e()})).catch((()=>{}))},disabled:!R||A||D||G,loading:D,"aria-label":c.string("fusion_attraction_commerce_booking"),fullWidth:p,marginRight:"spacing-03",children:X(V,{id:"attractions_add_to_cart_cta"})}),ie=null==R?void 0:R.timedEntry,re=null==R?void 0:R.tourGrade,ne=ie&&"detailedPrice"in ie&&null!=(Q=ie.detailedPrice)&&Q.length?ie.detailedPrice:null,ae=null!=re&&re.detailedPrice&&null!=($=re.detailedPrice)&&$.length?re.detailedPrice:ne,le=ie&&"totalPrice"in ie?ie.totalPrice:null,oe=(null==re?void 0:re.totalPrice)||le,ce=ae?X(b,{variant:"title-05",children:ae.filter(Boolean).map(((e,t)=>X("div",{className:"GzZRs",children:X(z,{model:e})},t)))}):null,se=oe?X(b,{variant:"title-05",children:X(z,{model:oe})}):null;q=ee("div",{className:"dyqcu",children:[ee("div",{className:v("rXFwm k"),children:[ce,se]}),ee("div",{className:v("zadtN"),children:[X("div",{children:te}),X("div",{children:Z})]})]})}var de,ue,me,pe=o?B(localStorage.getItem("AttractionListCommerceStartDate")):T;if("TICKETS"===f)({contentId:de,contentType:ue,state:me}={contentId:n.ticketContentId,contentType:n.ticketContentType,state:n.ticketContentState});else if("TOURGRADES"===f){var ve,ge,Te,he,Ce=null;"Routing_AttractionCommerceParameters"===(null==I||null==(ve=I.webRoute)||null==(ge=ve.typedParams)?void 0:ge.__typename)&&({contentId:Te,contentType:he,state:Ce}=I.webRoute.typedParams),({contentId:de,contentType:ue,state:me}={contentId:n.tourContentId||Te,contentType:n.tourContentType||he,state:n.tourContentState||Ce})}var[{data:_e,fetching:ke,polling:ye,error:be},Ee]=rt({contentId:de,contentType:ue,state:me,customDate:pe});return r((()=>{be&&(console.error("[Fusion][Availability] attraction commerce query resulted in an error",be.message),U())}),[be,U]),X(E.Provider,{value:{setTicketInfo:x,clearTourGrade:K,setFusionDates:t,onSelectTicket:N,onSelectTourGrade:F,selectedTourGrade:R,useDateFromLocalStorage:o},children:X(y,{variant:"fixed-height-sticky-footer",heightOption:"restricted-full",footer:p?q:void 0,onClose:A?void 0:e,children:ee("div",{className:v("DRTxf",{"otHUz S":A}),children:[null!=H&&X("div",{className:"FtNql",children:H}),null!=O&&X(b,{variant:"title-03",marginBottom:"spacing-03",children:O}),"GENERIC_ERROR"!==f&&X(ot,{result:_e,fetching:ke,polling:ye,update:Ee,duplicateItemError:G}),"GENERIC_ERROR"===f&&X(je,{})]})})})},ei=({onClose:e,setFusionDates:t,isAttractionCommerceModalOpen:i,initialStep:r="TICKETS",link:a=null,isRnplEligible:l=!1,trackingKey:o="",contentId:c="0",isListPage:v=!1})=>{var g,T,h,C,{cartButtonRef:_}=d(),[k,y]=n(!1),[b,E]=n(void 0),f="MOBILE"===s(),[P]=u(),[S]=m(),I=f&&"test"===P||!f&&"test"===S,R=null;"Routing_AttractionCommerceParameters"===(null==a||null==(g=a.webRoute)||null==(T=g.typedParams)?void 0:T.__typename)&&({contentId:h,contentType:C,state:R}=a.webRoute.typedParams);var D={tourContentId:h,tourContentType:C,tourContentState:R,ticketContentId:c,ticketContentType:"attraction",ticketContentState:"tickets"};return ee(te,{children:[k&&b&&X(p,{triggerRef:_,addToCartData:b,onClose:()=>y(!1)}),i&&!I&&X(nt,{contentId:c,onClose:e,setFusionDates:t,initialStep:r,link:a,isRnplEligible:l,trackingKey:o,isListPage:v,onAddToCart:e=>{E({cartItems:e}),y(!0)}}),i&&I&&X(ct,{onClose:e,setFusionDates:t,contentInfo:D,initialStep:r,useDateFromLocalStorage:v,onAddToCart:e=>{E({cartItems:e}),y(!0)}})]})};return e("useBookingCallbacks",Ut),[()=>{ze=T((({elementType:e,size:t="medium",fullWidth:i,legacyStyled:r=!1,children:n,loading:a=!1,"aria-label":l="",dataAttributes:o={},...c},s)=>{var d=q(),[u,m]=Q(c);return X(e,{className:v("eMJil _G B- z _S c Wc","dGnrn",d,$(u),{w:i,evJyH:"small"===t,oERcv:"medium"===t,eLZJG:"large"===t,fbGTB:r,ktbpe:a}),...o,...m,ref:s,children:r?n:ee(te,{children:[X(b,{variant:"button-01",elementType:"span",children:n}),a&&X("div",{className:"saeZa t _U s l j u",children:X(Z,{variant:"small","aria-label":l})})]})})})),Ve=ze,je=st,Ye=P(ut),Je=Tt,qe=R(Ct),He=P(bt),Qe=R(Et),$e=R(Pt),Ze=St,Xe=Rt,et=At,tt=Ot,it=A({executeQuery:xt,extractPollingStatus:e=>G(null==e?void 0:e.status),mergeUpdate:w}),nt=Vt,at=jt,lt=Yt,ot=Zt,ct=Xt,e({AttractionCommerceError:je,CartButton:Ve,default:ei,useAttractionCommerceReducer:tt,useAttractionCommerceWebQuery:rt=Lt,useBookingCallbacks:Ut})},[e=>(i=e,r=e.useEffect,n=e.useState,a=e.useMemo,l=e.useCallback,o=e.useContext,c=e.useReducer),e=>s=e.useViewportCategory,e=>d=e.default,e=>(u=e.useBookingModuleMobileTest,m=e.useBookingModuleDesktopTest),e=>p=e.default,e=>v=e.default,e=>(g=e.default,T=e.forwardButtonOrLinkRef,h=e.BorderlessButton,C=e.CircularButton),e=>_=e.default,e=>k=e.default,e=>y=e.Modal,e=>b=e.default,e=>(E=e.default,f=e.useBookingFlowContext),e=>(P=e.FusionComponent,S=e.useTracking,I=e.FusionTrackedLink,R=e.fused,D=e.WPSUnsupportedType,A=e.createUseWPSQuery,G=e.defaultExtractPollingStatus,w=e.defaultMergeSectionResults,O=e.useEntrypointContext,N=e.ISODateString),e=>(x=e.default,L=e.useAttractionDates,B=e.parseIsoDate,F=e.useAttractionPax,K=e.useSingleDatePicker,U=e.usePaxPicker),e=>M=e.default,e=>W=e.LabelsList,e=>z=e.default,e=>(V=e.default,j=e.useLocalize,Y=e.UnsafeLocalize),e=>J=e.usePixelCallback,e=>q=e.useKeyboardFocusableClassName,e=>(H=e.default,Q=e.getMarginProps,$=e.margin),e=>Z=e.Spinner,e=>(X=e.jsx,ee=e.jsxs,te=e.Fragment),e=>ie=e.default,e=>re=e.BubbleRatingWithReviewCount,e=>ne=e.default,e=>ae=e.default,e=>le=e.deriveLinkInfo,e=>(oe=e.RadioButton,ce=e.RadioGroup),e=>se=e.default,e=>de=e.useOnVisible,e=>ue=e.default,e=>(me=e.OptimusInteraction,pe=e.OptimusImpression,ve=e.OptimusImpressionWrapper),e=>ge=e.FunnelTracking,e=>Te=e.default,e=>he=e.default,e=>Ce=e.default,e=>_e=e.uuid,e=>(ke=e.useCashbackEnabled,ye=e.useBundledPlusOnExperiencesEnabled),e=>be=e.SingleSelectChipBar,e=>Ee=e.default,e=>fe=e.default,e=>Pe=e.asAttractionDatePicker,e=>Se=e.default,e=>Ie=e.default,e=>Re=e.default,e=>De=e.useExperiencesCashbackEnabled,e=>Ae=e.useQuery,e=>Ge=e.useTravelInfo,e=>we=e.useSessionId,e=>Oe=e.useUserId,e=>Ne=e.setLocalStorageCartCount,e=>xe=e.setPopupInfo,e=>(Le=e.buildCartProductInfoString,Be=e.setCartInfoWithProductAdd),e=>Fe=e.fetchDeleteNotifications,e=>Ke=e.default,e=>Ue=e.FreeCancellationIconNew,e=>Me=e.default,e=>We=e.useGetTermsLinks]]},["cDcdfi","oVKaZR","igzpAK","DY6uxn","EMGYi3","jSLlaY","7yGKf-","AhTrXA","5KqyYa","E1X9WP","VP50Wc","RfdFNG","PEYes_","CTabsQ","26GkLh","DbdFu5","2dxA8m","0DsHEV","jb_4W2","W3_c4H","iekllc","Ly5eaD","F5FCuN","bI-gyO","MBK0so","McEGSJ","jPSRY1","q-7VD4","MsxLpS","DCBGY9","PUj9cw","W3fm7L","T2p98h","ETqDaL","Za7u2_","gaBbwi","-WwUo-","O-HcBE","tVuenP","LGvznu","R5mFUK","RSzTs1","Q_toFx","2s99p_","nrwKz6","ohJPzG","S8Mnnq","5X2em-","9rUrE8","VJ7DQx","ukkKxE","XxFPum","bre2zH","MNe656","W15VPO","XFvNeg","cG1wiZ","iTPmVY","5kGyro"]]);
