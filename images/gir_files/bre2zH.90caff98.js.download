(this.$WP=this.$WP||[]).push(["bre2zH",(e,t)=>{"use strict";var a,o,i,n,r,l,c,d,u,s,p,h,v,m,g,C,_,k,b,f,I,P,w,y,D,A,x,S,R,M,T,F,G,U,B,O,V,W,E,N,j="attractionsCheckoutPopUpInfo",K=e=>{var t=d.get(j);return!t||t.lastSessionId!==e||Date.now()>t.timestamp+t.ttl},L=e=>{var t=d.get(j),a=t&&t.popupInfo;return!a||a.productCode!==e.productCode||a.tourGradeCode!==e.tourGradeCode||!a.dismissed},Y=(e,t,a,o)=>{if(e){var i="string"==typeof t?t:t.originalValue||t.encodedValue&&c(t.encodedValue);if(i){var n={lastSessionId:e,popupInfo:{productCode:i,tourGradeCode:a,dismissed:o},timestamp:Date.now(),ttl:G,logicV2:!0};d.set(j,n,U)}}},q=e=>{var{productCode:t,tourGradeCode:a}=e.productParameters;return{productCode:t,tourGradeCode:a}},z={productCode:null,cartItemId:null,trackAction:()=>{}},H=(e,t,a,o)=>{var i={productCode:e,pax:t,date:C(a,"YYYY-MM-DD"),message:o};d.set("attractionsUnavailableMessage",i,12e4)},J=e=>e.filter((e=>e.count>0)),Q=e=>J(e).map((e=>e.bandSummaryFormatted)).join(" | "),X=e=>new Map(J(e).map((e=>[e.bandId,e.count]))),Z=(e,t,a,o)=>s(e,X(t),a,o),$=e=>e.filter(Boolean).join(" â€¢ "),ee=({productCode:e,locationId:t,tourGradeCode:a,pax:i,travelDate:n,onAvailCheckSuccess:r,onAvailCheckFailure:l})=>{var{localize:c}=P(),d=w();return o((()=>{p(e,a,n,X(i),null,t||0,c,d).then((e=>{((e,t)=>t.some((t=>t.available&&t.gradeCode===e)))(a,e)&&r()})).catch((e=>{l()}))}),[t,l,r,i,e,a,n,c,d]),null},te=e=>{var{onAvailCheckSuccess:t,onAvailCheckFailure:a}=e,[o,r]=i(!0),l=n((()=>{r(!1)}),[]),c=n((()=>{l(),t()}),[l,t]),d=n((()=>{l(),a()}),[l,a]),u={...e,onAvailCheckSuccess:c,onAvailCheckFailure:d};return A(x,{children:[o&&S(D,{}),S(O,{...u})]})},ae={width:360,height:240},oe=e=>null!=e&&e.length>0,ie=({title:e,url:t,imageUrl:a,departureTime:i,formattedPax:n,price:l,cancellationMessage:c,numReviews:d,bubbleRating:u,trackAction:s})=>{var p=f(),{trackAction:h}=r(B),v=s||h;return o((()=>{v("impression_lightbox")}),[v]),A("div",{className:"cmZPc A Fi",children:[S("div",{className:"w",children:S(T,{theme:"image",href:t,target:"_blank",onClick:()=>v("click_photo"),children:S(M,{source:[{...ae,url:a||""}],alt:e,width:"100%",aspectRatio:"MOBILE"===p?"auto":"1:1"})})}),A("div",{className:"HOyaN A",children:[S(T,{theme:"standalone",href:t,target:"_blank",onClick:()=>v("click_title"),children:S(y,{variant:"title-04",children:e})}),null!=d&&null!=u&&(d>0||u>0)&&S(R,{numReviews:d,rating:u,size:"small"}),oe(i)&&S(y,{variant:"supporting-01",children:i}),oe(n)&&S(y,{variant:"supporting-01",children:n}),oe(c)&&S(y,{variant:"supporting-01",children:c}),S(y,{variant:"supporting-03",children:l})]})]})},ne={__key:0x63dc871415ad,id:"63dc871415addfd41943d65c6ac5ff9b",loc:{},definitions:[]},re=({productId:e,productCode:t,tourGradeCode:a,pax:c,travelDate:d,travelDateUI:u,displayedPrice:s,productDisplay:p,cancellationMessage:v,isAvailable:m,bubbleRating:C,numReviews:D})=>{var x,{localize:R}=P(),M=w(),{trackAction:T}=r(B),F=l(),G="MOBILE"===f(),[U,O]=i(!1),[E,N]=i(!1),[j]=g({query:ne,variables:{productId:e},requestPolicy:"network-only"}),{fetching:K,data:q}=j,z=null==q||null==(x=q.attractionProducts)?void 0:x[0],J=null==z?void 0:z.url;o((()=>{!K&&q&&O(L({productCode:t,tourGradeCode:a}))}),[q,K,t,a]);var X=n((()=>{setTimeout((()=>{window.location.href="/shoppingCartCheckout?isCartless=true"}),300)}),[]),ee=n((()=>{null!=J&&J.length>0&&(H(t,c.map((({bandId:e,count:t})=>({bandId:e,count:t}))),h(d),Z(d,c,R,M)),window.location.href=J)}),[J,c,t,d,R,M]),te=n((e=>{Y(F,t,a,e)}),[t,a,F]),ae=n((()=>{T("click_exit"),O(!1),te(!0)}),[te,T]),oe=_((()=>{te(!1)})),{name:ie,url:re,imageUrl:le,activityId:ce}=z||{};return null!=ie&&ie&&null!=re&&re&&U&&ie&&re?S(b,{title:S(I,{id:"attractions_checkout_abandonment_popup_header"}),primaryButton:S(k,{onClick:()=>{T("click_continue_checkout"),N(!0)},fullWidth:G,disabled:!m,children:S(I,{id:"attractions_checkout_abandonment_popup_continue_checkout"})}),secondaryButton:S(k,{variant:"secondary",href:re,target:"_blank",onClick:()=>{T("click_view_details"),te(!0)},fullWidth:G,children:S(I,{id:"attractions_checkout_abandonment_popup_view_details"})}),onClose:ae,buttonsAlignment:"left",buttonStyle:G?"stacked":void 0,children:A("div",{ref:oe,children:[S(W,{title:ie,url:re,imageUrl:le,departureTime:$([p.gradeDepartureTime,u]),formattedPax:Q(p.passengerMix),price:s,cancellationMessage:v,bubbleRating:C,numReviews:D}),E&&S(V,{productCode:t,locationId:ce,tourGradeCode:a,pax:c,travelDate:d,onAvailCheckSuccess:X,onAvailCheckFailure:ee}),S(y,{variant:"supporting-02",marginTop:"spacing-04",children:S(I,{id:"attractions_checkout_abandonment_popup_avail_and_price_change"})})]})}):null},le=()=>{var e=m(),{status:t,data:a}=u({checkout:!0}),n=a&&0!==a.length?a[0]:null,r=v(t),[l,c]=i(z);if(o((()=>{if("Fetching"===r&&"Success"===t&&n){var{productCode:a}=n.productParameters,o=n.id;c({productCode:a,cartItemId:o,trackAction:t=>{e({module:"checkout_abandonment_box",action:t,context:[a,o,String(!1)].join(" | ")})}})}}),[n,r,e,t]),!n)return null;var d=n.productParameters,{productId:s,productCode:p,tourGradeCode:g,checkinDate:C,checkinDateUI:_,cancellationCondition:k,bookingProduct:b}=d,f=n.display,{passengerMix:I}=f,P=n.availability.priceFormatted;return S(B.Provider,{value:l,children:"PAST_CHECKIN_DATE"!==n.notificationType&&h(C)>=new Date&&S(E,{productId:s,productCode:p,tourGradeCode:g,pax:I,travelDate:C,travelDateUI:_,displayedPrice:P,cancellationMessage:k,productDisplay:f,isAvailable:!n.notificationType,bubbleRating:null==b?void 0:b.rating,numReviews:null==b?void 0:b.num_reviews})})},ce=()=>{var[e,t]=i(!1),a=l();return o((()=>{K(a)&&t(!0)}),[a]),e&&S(N,{})},de=({productId:e,productCode:t,tourGradeCode:a,pax:r,travelDate:c,travelDateUI:d,displayedPrice:u,productDisplay:s,cancellationMessage:p,isAvailable:v,bubbleRating:C,numReviews:D,itemId:x,onClose:R})=>{var M,T=m(),{localize:G}=P(),U=w(),B=l(),O="MOBILE"===f(),[E,N]=i(!1),[j,K]=i(!1),L=n((e=>{T({module:"checkout_abandonment_box",action:e,context:[t,x,String(!1)].join(" | ")})}),[T,t,x]),[q]=g({query:ne,variables:{productId:e},requestPolicy:"network-only"}),{fetching:z,data:J}=q,X=null==J||null==(M=J.attractionProducts)?void 0:M[0],ee=null==X?void 0:X.url;o((()=>{!z&&J&&N(!0)}),[J,z,t,a]);var te=n((()=>{setTimeout((()=>{window.location.href="/shoppingCartCheckout?isCartless=true"}),300)}),[]),ae=n((()=>{null!=ee&&ee.length>0&&(H(t,r.map((({bandId:e,count:t})=>({bandId:e,count:t}))),h(c),Z(c,r,G,U)),window.location.href=ee)}),[ee,r,t,c,G,U]),oe=n((e=>{Y(B,t,a,e)}),[t,a,B]),ie=n((()=>{L("click_exit"),N(!1),oe(!0),R()}),[oe,L,R]),[,re]=F(),le=_((()=>{oe(!1),re()})),{name:ce,url:de,imageUrl:ue,activityId:se}=X||{};return null!=ce&&ce&&null!=de&&de&&E&&ce&&de?S(b,{title:S(I,{id:"attractions_checkout_abandonment_popup_header"}),primaryButton:S(k,{onClick:()=>{L("click_continue_checkout"),K(!0)},fullWidth:O,disabled:!v,children:S(I,{id:"attractions_checkout_abandonment_popup_continue_checkout"})}),secondaryButton:S(k,{variant:"secondary",href:de,target:"_blank",onClick:()=>{L("click_view_details"),oe(!0)},fullWidth:O,children:S(I,{id:"attractions_checkout_abandonment_popup_view_details"})}),onClose:ie,buttonsAlignment:"left",buttonStyle:O?"stacked":void 0,children:A("div",{ref:le,children:[S(W,{title:ce,url:de,imageUrl:ue,departureTime:$([s.gradeDepartureTime,d]),formattedPax:Q(s.passengerMix),price:u,cancellationMessage:p,bubbleRating:C,numReviews:D,trackAction:L}),j&&S(V,{productCode:t,locationId:se,tourGradeCode:a,pax:r,travelDate:c,onAvailCheckSuccess:te,onAvailCheckFailure:ae}),S(y,{variant:"supporting-02",marginTop:"spacing-04",children:S(I,{id:"attractions_checkout_abandonment_popup_avail_and_price_change"})})]})}):null};return[()=>{G=72e5,U=2592e6,B=a(z),O=ee,V=te,W=ie,E=re,N=le,e({CHECKOUT_POPUP_INFO_SNAPSHOT_KEY:j,CheckoutItemProductInformation:de,buildCheckoutProductInfo:q,default:ce,setPopupInfo:Y,shouldShowPopup:K,shouldShowPopupWithRetrievedPopupInfo:L})},[e=>(a=e.createContext,o=e.useEffect,i=e.useState,n=e.useCallback,r=e.useContext),e=>l=e.useSessionId,e=>c=e.default,e=>d=e.default,e=>u=e.useFetchShoppingData,e=>(s=e.soldOutMessageGated,p=e.getTourGrades,h=e.getLocalDateFromString),e=>v=e.default,e=>m=e.useGARecorder,e=>g=e.useQuery,e=>C=e.getDateFormat,e=>_=e.useOnVisible,e=>k=e.default,e=>b=e.Modal,e=>f=e.useViewportCategory,e=>(I=e.default,P=e.useLocalize,w=e.useIntlFormatter),e=>y=e.default,e=>D=e.LoadingSpinner,e=>(A=e.jsxs,x=e.Fragment,S=e.jsx),e=>R=e.BubbleRatingWithReviewCount,e=>M=e.default,e=>T=e.default,e=>F=e.useNewCheckoutDesignAndAbandonedPopupLogicTest]]},["cDcdfi","VJ7DQx","dROhDJ","jaCyxS","W15VPO","4fTSbk","vWxBAe","fsml46","5X2em-","nCau_D","PUj9cw","7yGKf-","E1X9WP","oVKaZR","0DsHEV","VP50Wc","V08PS7","F5FCuN","MBK0so","BgJkqv","5KqyYa","DY6uxn"]]);
