(this.$WP=this.$WP||[]).push(["MNe656",(e,t)=>{"use strict";var r,a,i,o,n,s,l,d,c,u,p,m,g,h,v,C,_,f,k,I,b,y,P,S,w,D,T,N,A,x,E,O,V,M,F,L,R,G,U,W,z,B="DEFAULT",H="attractionsCheckoutPopUpInfo",K=()=>{var e=y.get(H);e&&!e.logicV2&&y.remove(H)},j=e=>{var t=y.get(H),r=t&&t.popupInfo;t&&r&&("Treatment 1"===e&&Date.now()>t.timestamp+O&&$(!1),"Treatment 2"===e&&Date.now()>(null==t?void 0:t.timestamp)+V&&$(!1))},J=(e,t,r)=>{var{productParameters:a}=t,{productCode:i,tourGradeCode:o}=a||{};((e,t,r,a,i)=>{if(e){var o="string"==typeof t?t:t.originalValue||t.encodedValue&&P(t.encodedValue);if(o){var n={lastSessionId:e,popupInfo:{productCode:o,tourGradeCode:r,dismissed:a},timestamp:Date.now(),ttl:M,logicV2:!0};a&&ie(!0),y.set(H,n,F)}}})(e,i,o,r)},$=e=>{var t=y.get(H),r=t&&t.popupInfo;if(t&&r){var a={productCode:r.productCode,tourGradeCode:r.tourGradeCode,dismissed:e},i={...t,lastSessionId:t.lastSessionId,popupInfo:a};y.set(H,i,F)}},Y="attractionsAbandonedCartPopupInfo",X=e=>{var t=y.get(Y);if(!t)return!0;var r=t.lastSessionId!==e,a=Date.now()>t.timestamp+t.ttl;return r||a},Q=()=>{var e=y.get(Y);e&&!e.logicV2&&y.remove(Y)},Z=e=>{var t=y.get(Y);null!=t&&t.suppress&&("Treatment 1"===e&&Date.now()>t.timestamp+G&&ie(!1),"Treatment 2"===e&&Date.now()>t.timestamp+U&&ie(!1))},q=e=>{var t=y.get(Y);return!t||!t.suppress||!((e,t)=>{if(!e&&!t)return!0;if(!e||!t)return!1;var r=new Set(e),a=new Set(t);if(r.size!==a.size)return!1;var i=!0;return r.forEach((e=>{a.has(e)||(i=!1)})),i})(t.cartProductInfo,e)},ee=(e,t,r,a)=>{if(null!=e&&""!==e){var i=y.get(Y),o=(null==i?void 0:i.cartProductInfo)||[];""!==r&&o.push(r);var n={lastSessionId:e,suppress:t,cartProductInfo:o,timestamp:Date.now(),ttl:L,logicV2:!0};t&&!a&&$(!0),y.set(Y,n,R)}},te=(e,t,r)=>{if(null!=e&&""!==e){var a=y.get(Y),i={lastSessionId:e,suppress:t,cartProductInfo:(null==a?void 0:a.cartProductInfo)||[],timestamp:Date.now(),ttl:L,logicV2:!0};t&&!r&&$(!0),y.set(Y,i,R)}},re=(e,t,r,a)=>JSON.stringify({productCode:e,tourGradeCode:t,tourDate:r,passengerMix:a}),ae=e=>e.map((e=>{var{productCode:t,tourGradeCode:r,checkinDate:a,passengerMix:i}=e.productParameters;return re(t,r,a,JSON.stringify(i))})),ie=e=>{var t=y.get(Y);if(null!=t){var r={...t,suppress:e};y.set(Y,r,R)}},oe=({productItemData:e,abandonedModalType:t,sessionId:r,onClick:a=(()=>{})})=>{var i="MOBILE"===v(),o="CART"===t,{params:n}=h(),s=null!=n.geoId?n.geoId:void 0,{trackClick:l}=D(),u=((e,t)=>{var{availability:{price:r,priceCurrency:a},productParameters:i}=e,{productCode:o,bookingProduct:n}=i;return JSON.stringify({prc:r,cur:a,apc:o,lid:t,sprc:null!=(null==n?void 0:n.strike_thru_price)&&""!==n.strike_thru_price})})(e,s),{availability:p,display:m,productParameters:g}=e,{productName:C,imageUrl:_,gradeName:f,passengerMix:k}=m,{num_reviews:I,rating:b,detail_url:y}=g.bookingProduct||{},{checkinDateUI:P,cancellationCondition:E}=g,O=p.priceFormatted,V=N(A,{children:[x("div",{dangerouslySetInnerHTML:{__html:f}}),x("div",{className:"Ph",children:P})]}),M=null!=E&&!i&&N("div",{className:"Ph f",children:[x(S,{marginRight:"spacing-01"}),E]}),F=N(A,{children:[k.map((e=>x(d,{variant:"supporting-01",marginBottom:"spacing-01",children:x(T,{ageBand:e})}))),O]});return x(w,{title:C,primaryInfo:V,secondaryInfo:M,merchandisingText:F,labels:c(e),rating:b,reviewCount:I,url:y,thumbnail:_,onClick:()=>{o&&te(r,!1),l({clientContext:o?"onClickCartItem":"onClickCheckoutItem",trackingKey:u,trackingTitle:o?"abandonedCartModule":"abandonedCheckoutModule"}),a()},enforceMaxImageSize:!0,height:i?70:130,width:i?70:130})},ne=({productCode:e,locationId:t,tourGradeCode:r,pax:a,travelDate:o,onAvailCheckSuccess:n,onAvailCheckFailure:s})=>{var{localize:l}=_(),d=f();return i((()=>{(function(e,t,r,a,i,o,n,s,l,d,c){var u=((e,t,r,a)=>((e,t,r,a)=>{var i=a.formatDate("week_date_long",e),o=((e,t)=>{var r,a=1===e.size;return 1===(r=Array.from(e,(e=>((e,t,r,a)=>{if(r)return a.string("attractions.booking.common_n_traveler",{0:t});if(t<1)return"";switch(e){case 1:return a.string("attractions.booking.common_n_adult",{0:t});case 2:return a.string("attractions.booking.common_n_child",{0:t});case 3:return a.string("attractions.booking.common_n_infant",{0:t});case 4:return a.string("attractions.booking.common_n_youth",{0:t});case 5:return a.string("attractions.booking.common_n_senior",{0:t});default:return""}})(e[0],e[1],a,t))).filter((e=>""!==e))).length?r[0]:r.join(", ")})(t,r);return r.string("attractions.booking.tour_grade_unavailable_for_pax_date",{PAX:o,date:i})})((e=>{var[t,r,a]=e.split("-").map((e=>parseInt(e,10)));return new Date(t,r-1,a)})(e),t,r,a))(r,a,n,s);return new Promise(((i,s)=>{var l=new URLSearchParams;l.append("tourDate",r),l.append("attrdate",(e=>e.replace(/-/g,"_"))(r)),l.append("ageBands",Array.from(a).map((e=>`${e[0]}:${e[1]}`)).join(",")),l.append("locationId",JSON.stringify(o));var d=`/AttractionBookingApi/product/${e}/tour_grades?${l.toString()}`,c=e=>{fetch(d,{credentials:"same-origin"}).then((e=>{if(e.ok)return e;throw Error(e.statusText)})).then((e=>e.json())).then((r=>{if("COMPLETE"===r.polling_state)try{var a=r.tour_grades.map((e=>({gradeCode:e.grade_code,sortOrder:e.sort_order,rnplEligibility:{eligible:!!e.rnpl_eligibility&&e.rnpl_eligibility.eligible,ineligibilityReasons:e.rnpl_eligibility?e.rnpl_eligibility.ineligibility_reasons:[]},gradeTitle:B===e.grade_title?t:e.grade_title,gradeDescription:B===e.grade_title?"":e.grade_description,priceFormatted:e.price_formatted,maxTravelersPerUnit:e.max_travelers_per_unit,ageBandsDisplay:e.age_bands.map((e=>e.band_summary)),available:e.available,isMostPopularText:e.is_most_popular_text,langServices:null!==e.lang_services?Object.keys(e.lang_services):null})));a.some((e=>e.available))||s(Error(u)),i(a)}catch(e){s(Error(n.string("attractions.booking.errors.api_error")))}else"IN_PROGRESS"===r.polling_state&&e<30?setTimeout((()=>c(e+1)),1e3):"NO_LONGER_AVAILABLE"===r.polling_state?s(Error(u)):s(Error(r.error_messages[0]))})).catch((()=>{s(Error(n.string("attractions.booking.errors.api_error")))}))};c(1)}))})(e,r,o,(e=>new Map((e=>e.filter((e=>e.count>0)))(e).map((e=>[e.bandId,e.count]))))(a),0,t||0,l,d).then((e=>{((e,t)=>t.some((t=>t.available&&t.gradeCode===e)))(r,e)&&n()})).catch((e=>{s()}))}),[t,s,n,a,e,r,o,l,d]),null},se=e=>{var{onAvailCheckSuccess:t,onAvailCheckFailure:i}=e,[o,n]=r(!0),s=a((()=>{n(!1)}),[]),l=a((()=>{s(),t()}),[s,t]),d=a((()=>{s(),i()}),[s,i]),c={...e,onAvailCheckSuccess:l,onAvailCheckFailure:d};return N(A,{children:[o&&x(E,{variant:"medium"}),x(ne,{...c})]})},le=({checkoutItem:e})=>{var t=e.productParameters,{productCode:r,tourGradeCode:i,checkinDate:o,productId:n,bookingProduct:s}=t,{detail_url:l}=s||{},d=e.display,{passengerMix:c}=d,u=a((()=>{setTimeout((()=>{window.location.href="/shoppingCartCheckout?isCartless=true"}),300)}),[]),p=a((()=>{null!=l&&l.length>0&&(window.location.href=l)}),[l]);return e?x(se,{productCode:r,locationId:n,tourGradeCode:i,pax:c,travelDate:o,onAvailCheckSuccess:u,onAvailCheckFailure:p}):null},de=({productItems:e,abandonedModalType:t,onClose:i})=>{var c,_,f="MOBILE"===v(),P="CART"===t,S="CHECKOUT"===t,w=null==e?void 0:e[0],D=k(),{page:T}=h(),A=g(),E=b(),O=a((({itemName:e,itemId:t})=>{E({actionType:"click",itemName:e,itemGroup:P?"abandonedCartModule":"abandonedCheckoutModule",itemId:t,page:T})}),[P,E,T]),V=u(),[M,F]=r(!1),G=((e,t,r)=>{var a=e.length,i=e.reduce(((e,t)=>e+t.availability.price||0),0);return JSON.stringify({gbv:i,cur:t,ni:a,pageType:r})})(e,D,T),[U,B]=m(),H=o((()=>{P?((e,t,r,a)=>{if(null!=e&&""!==e){var i={lastSessionId:e,suppress:t,cartProductInfo:r,timestamp:Date.now(),ttl:L,logicV2:!0};t&&$(!0),y.set(Y,i,R)}})(A,"control"===U,ae(e)):J(A,w,!1),B(),O({itemName:P?"abandonedCartVisibleImpression":"abandonedCheckoutVisibleImpression",itemId:G})})),K=()=>{P?te(A,!0):J(A,w,!0),O({itemName:P?"closeCartModule":"closeCheckoutModule",itemId:G}),i()},j=()=>{P?te(A,!1):F(!0),O({itemName:P?"viewCartAndCheckout_click":"continueCheckout_click",itemId:G})},X=P&&e.length>1?x(C,{id:"sng_adventures_await"}):x(C,{id:"experiences_your_adventure_awaits"}),Q=x("div",{className:"Hnwvr f e",children:e.map((e=>x(W,{abandonedModalType:t,productItemData:e,sessionId:A,onClick:i},e.id)))}),Z=x(n,P?{variant:"commerce",size:"small",href:V,onClick:j,fullWidth:f,children:x(I,{id:"view_cart_checkout"})}:{variant:"commerce",size:"medium",onClick:j,fullWidth:f,children:x(C,f?{id:"attractions.booking.checkout"}:{id:"attractions_checkout_abandonment_popup_continue_checkout"})}),q=x(n,{variant:"secondary-commerce",size:"medium",target:"_blank",href:(null==(c=w.productParameters)||null==(_=c.bookingProduct)?void 0:_.detail_url)||"",fullWidth:f,marginRight:"spacing-03",onClick:()=>{J(A,w,!1),O({itemName:"clickViewDetails",itemId:G})},children:x(C,{id:"attractions_checkout_abandonment_popup_view_details"})}),ee=N("div",{className:"f F Pk PY Px PK",children:[S?q:null,Z]}),re=p(e),ie=N("div",{ref:H,className:"STUWh",children:[Q,re&&x("div",{className:"OyNYT",children:x(d,{variant:"supporting-02",children:x(C,{id:"attractions_ltso_disclaimer_text_bottom"})})}),S&&M&&x(z,{checkoutItem:w})]});return S&&"PAST_CHECKIN_DATE"===w.notificationType&&(e=>{var[t,r,a]=e.split("-").map((e=>parseInt(e,10)));return new Date(t,r-1,a)})(w.productParameters.checkinDate)<new Date?null:f?x(l,{title:X,onClose:K,mobileContainerStyle:"inset",mobileInsetHeight:"fixed",stickyFooter:ee,children:ie}):x(s,{variant:"fixed-height-sticky-footer",heightOption:"restricted",title:X,footer:ee,onClose:K,children:ie})};return[()=>{O=2592e5,V=6048e5,M=72e5,F=2592e6,L=72e5,R=2592e6,G=2592e5,U=6048e5,W=oe,z=le,e({CART_POPUP_INFO_SNAPSHOT_KEY:Y,buildCartProductInfo:ae,buildCartProductInfoString:re,clearOutdatedStoredCartValues:Q,clearOutdatedStoredCheckoutValues:K,default:de,isCartPopupExpired:X,setCartInfoWithProductAdd:ee,setCartInfoWithoutProduct:te,shouldShowCartPopup:q,tryResetCartSuppressValue:Z,tryResetCheckoutDismissValue:j})},[e=>(r=e.useState,a=e.useCallback,i=e.useEffect),e=>o=e.useOnVisible,e=>n=e.default,e=>(s=e.Modal,l=e.ModalContainer),e=>d=e.default,e=>(c=e.buildCartItemLabels,u=e.useCartUrlWithFunnelKey,p=e.cartItemsContainLTSO),e=>m=e.useNewCheckoutDesignAndAbandonedPopupLogicTest,e=>g=e.useSessionId,e=>h=e.useRoute,e=>v=e.useViewportCategory,e=>(C=e.default,_=e.useLocalize,f=e.useIntlFormatter,k=e.useCurrency,I=e.UnsafeLocalize),e=>b=e.useInteractionV3Logger,e=>y=e.default,e=>P=e.default,e=>S=e.default,e=>w=e.HorizontalMerchandisingCard,e=>D=e.useFusionTracking,e=>T=e.default,e=>(N=e.jsxs,A=e.Fragment,x=e.jsx),e=>E=e.Spinner]]},["cDcdfi","PUj9cw","7yGKf-","E1X9WP","VP50Wc","agWPHr","DY6uxn","VJ7DQx","F8raOV","oVKaZR","0DsHEV","fsml46","jaCyxS","dROhDJ","65W9ZJ","U1tcLB","BfEQXK","mF32av","F5FCuN","Ly5eaD"]]);
