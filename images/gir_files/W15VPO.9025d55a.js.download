(this.$WP=this.$WP||[]).push(["W15VPO",(e,t)=>{"use strict";var r,a,i,n,s=({pollingCall:e,completeResponsePredicate:t,pollInterval:a=1e3,maxTries:i=10,pause:n=!1})=>{var s=r.useRef(),o=r.useRef(0),l=r.useRef((()=>{})),[c,u]=r.useState({fetching:!n,refetch:()=>{}}),[p,h]=r.useState(n),d=r.useCallback((()=>{l.current()}),[]);return r.useEffect((()=>{var e=c.data&&t(c.data);!p||n||e||(h(!1),u({fetching:!0,refetch:d}))}),[d,t,c.data,n,p]),r.useEffect((()=>{if(p)return()=>{};var r=()=>{if(o.current<i){o.current+=1;var n=o.current;e().then((e=>{o.current===n&&t(e)&&(u({fetching:!1,data:e,refetch:d}),clearTimeout(s.current))})).catch((e=>{})),s.current=setTimeout(r,a)}else u({fetching:!1,refetch:d})};return l.current=()=>{p||(o.current=0,r(),u({fetching:!0,refetch:d}))},r(),()=>{s.current&&clearTimeout(s.current)}}),[p]),c},o=(e,t)=>{var r=t.notifications&&t.notifications.find((({cartItemId:t})=>t===e.id)),a=r&&r.notificationType||null;return{...e,notificationType:a}},l=e=>fetch(e?"/ShoppingCartApi/cart/summary?isCartless=true":"/ShoppingCartApi/cart/summary",{credentials:"same-origin"}).then((t=>t.ok?t:(console.error(`[ShoppingCart] Failed fetching ${e?"checkout":"cart"} summary`,JSON.stringify(t)),Promise.reject()))).then((e=>e.json())),c=()=>l(!1),u=e=>e&&"IN_PROGRESS"!==e.polling_state,p=({checkout:e,runQuery:t=!0,useRobotSafe:s=!0,verifyEmptyData:c=!0})=>{var p,[h,d]=r.useState("Fetching"),[f,m]=r.useState(!1),g=a();r.useEffect((()=>{t?s&&!g?m(!1):c?l(e).then((e=>{0===e.itemCount?d("NoItem"):m(!0)})).catch((()=>d("Failed"))):m(!0):d("Abort")}),[e,t,c,g,s]);var S=n({pollingCall:()=>((e=!1)=>fetch(e?"/ShoppingCartApi/cart/detail?detailLevel=product&isCartless=true":"/ShoppingCartApi/cart/detail?detailLevel=product",{credentials:"same-origin"}).then((e=>e.ok?e.json():(console.error("[ShoppingCart] detail",JSON.stringify(e)),Promise.reject()))).catch((()=>({polling_state:"ERROR",result:null}))))(e),completeResponsePredicate:u,pollInterval:2e3,maxTries:5,pause:!f}),{fetching:v,data:C}=S,y=i(v),P=!v&&(null==C||null==(p=C.result)?void 0:p.cart)||null,E=(null==P?void 0:P.items)||null;return r.useEffect((()=>{null!=y&&y&&!v&&d(E?"Success":"Failed")}),[v,y,E]),{status:h,data:P&&E&&E.map((e=>o(e,P)))}},h=()=>fetch("/ShoppingCartApi/cart/detail?detailLevel=product",{credentials:"same-origin"}).then((e=>e.ok?e.json():Promise.reject(Error(JSON.stringify(e))))).catch((e=>(console.error("[ShoppingCart] poll cart page detail",e),{polling_state:"ERROR",result:null}))),d=e=>e&&"IN_PROGRESS"!==e.polling_state,f=()=>{var e,{fetching:t,data:a,refetch:i}=n({pollingCall:h,completeResponsePredicate:d,pollInterval:2e3,maxTries:5}),s=!t&&(null==a||null==(e=a.result)?void 0:e.cart)||null,l=r.useMemo((()=>{var e=(null==s?void 0:s.items)||null;return s?{cartItems:(null==e?void 0:e.map((e=>o(e,s))))||null,notifications:s.notifications,orderDetails:s.orderDetails,displayData:s.displayData}:null}),[s]);return{status:t?"Fetching":s?"Success":"Failed",data:l,refetch:i}},m=e=>fetch("/ShoppingCartApi/cart/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cartItemId:e}),credentials:"same-origin"}).then((e=>e.ok?e.json():Promise.reject(new Error(`The response was not \`ok\`: ${e.status}`)))).then((e=>e&&"SUCCESS"===e.status?e.cart:Promise.reject(new Error("The remove from cart query was not a success")))).then((e=>{var t;return null===e?Promise.reject(new Error("The remove from cart query was not a success: Cart items null")):{cartItems:(null==(t=e.items)?void 0:t.map((t=>o(t,e))))||null,notifications:e.notifications,orderDetails:e.orderDetails,displayData:e.displayData}})),g=e=>fetch("/ShoppingCartApi/cart/deleteNotifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notificationIds:e}),credentials:"same-origin"}).then((e=>e.ok?e.json():Promise.reject(new Error(`The response was not \`ok\`: ${e.status}`)))).then((e=>e&&"SUCCESS"===e.status?e.cart:Promise.reject(new Error(`The delete notification was not a success: ${null==e?void 0:e.status}`)))).then((e=>{var t;return null===e?Promise.reject(new Error("The delete notification query was not a success: Cart items null")):{cartItems:(null==(t=e.items)?void 0:t.map((t=>o(t,e))))||null,notifications:e.notifications,orderDetails:e.orderDetails,displayData:e.displayData}}));return[()=>{n=s,e({fetchCartSummary:c,fetchDeleteNotifications:g,fetchRemoveFromCart:m,useFetchCartPageData:f,useFetchShoppingData:p})},[e=>r=e,e=>a=e.useIsRobotSafe,e=>i=e.default]]},["cDcdfi","4Z07E2","vWxBAe"]]);
