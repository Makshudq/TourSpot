(this.$WP=this.$WP||[]).push(["P89JOf",(e,o)=>{"use strict";var r,t,i,n,s,a,u,c,l,d,p,_,m,C,E,g,v,D,R,P,h,A=()=>{var{localize:e}=p();return r((o=>{switch(o){case"REJECTED_INACTIVE":return e.string("plus_checkout_promo_code_expired");case"REJECTED_CONNECTION_ERROR":return e.string("plus_checkout_promo_code_error");case"REJECTED_INVALID_USER":return e.string("plus_checkout_promo_code_unauthorized");case"REJECTED_ALREADY_USED":return e.string("plus_checkout_promo_code_used");case"REJECTED_DISCOUNT_SERVICE_ERROR":default:return e.string("plus_checkout_promo_code_invalid")}}),[e])},y=({formFieldPrefix:e="pc",...o})=>{var{localize:l}=p(),{promoCodeForm:_,updatePromoCodeForm:D}=t(c),{appliedPromoCode:R,displayState:h,errorText:A,isApplying:T,promoCodeField:f}=_,O=P(),x=m(),b=r((()=>{x({OptimusDiscountCode:{optimusAction:{pageAction:"click",pageProperty:"promocode_link"}}}),D({displayState:"ShowPromoCodes"})}),[D,x]),I=r((e=>D({promoCodeField:{...f,value:e.toUpperCase()}})),[f,D]),N=r((()=>{x({OptimusDiscountCode:{optimusAction:{pageAction:"click",pageProperty:"promocode_apply",discountCode:f.value}}}),D({isApplying:!0})}),[D,x,f]),S=r((e=>{x({OptimusDiscountCode:{optimusAction:{pageAction:"in_view",pageProperty:"promocode_error",attribute:e}}})}),[x]),{subscriptionPrice:k}=y.useOptimusSubscriptionPrice("CHECKOUT"),{discount:F}=k||{};i((()=>{if(_.isApplying&&null!=F&&F.discountCode){var{discountCode:e,discountedPrice:o,originalPrice:r,status:t}=F;if("APPLIED"===t)D({appliedPromoCode:{amount:o-r,code:e,appliedPrice:k},isApplying:!1,promoCodeField:{..._.promoCodeField,isError:!1,value:""}});else{var i=O(t);D({appliedPromoCode:null,errorText:i,isApplying:!1,promoCodeField:{..._.promoCodeField,isError:!0,value:e}})}}}),[O,_,F,D,k]);var J=r((e=>O("REJECTED_CONNECTION_ERROR")===e?"connection_error":O("REJECTED_DISCOUNT_SERVICE_ERROR")===e?"invalid_code":O("REJECTED_INVALID_USER")===e?"unauthorized":O("REJECTED_ALREADY_USED")===e?"already_used":O("REJECTED_INACTIVE")===e?"cancelled_expired":""),[O]);return i((()=>{if(f.isError&&A){x({OptimusDiscountCode:{optimusAction:{pageAction:"failed",pageProperty:"promocode"}}});var e=J(A);S(e)}}),[f,A,x,J,S]),E(a,{...o,children:g(u,{dividers:!0,space:"spacing-03",children:[E(v,{}),"ShowPromoCodes"===h&&!R&&g(a,{display:"flex",className:"vhdxv O f",children:[E(C,{errorText:f.isError?A:void 0,id:`${e}-promoCodeInput`,marginRight:"spacing-03",onChange:e=>I(e.currentTarget.value),placeholder:l.string("plus_checkout_promo_code_placeholder"),state:f.isError?"error":"enabled",type:"text",value:f.value}),E(n,{dataAttributes:{"data-automation":"applyDiscount"},disabled:T,onClick:()=>f.value&&N(),variant:"secondary",children:E(d,{id:"plus_checkout_promo_code_apply"})})]}),"ShowLink"===h&&E(a,{marginY:"spacing-03",children:E(s,{dataAttributes:{"data-automation":"showDiscountInput"},onClick:b,children:E(d,{id:"plus_checkout_promo_code"})})})]})})};function T(e,o){var i=m(),{updatePromoCodeForm:n}=t(c),s=_(),{localize:a}=p(),u=_(),l=r((()=>{i({OptimusDiscountCode:{optimusAction:{pageAction:"success",pageProperty:"promocode"}}})}),[i]),d=null==e?void 0:e.discountCode;if(!e||!d)return null;var C=s.formatCurrencyInteger(e.originalPrice),E=e.discountedPrice-e.originalPrice,{expiryDate:g}=e,v=g?u.formatDate("date_short",new Date(g)):null,D=o?a.string("plus_partner_discount_tooltip",{0:o}):a.string("plus_first_year_discount_title"),R=`${a.string("plus_first_year_discount_body",{originalPrice:C})}\n  ${v?a.string("plus_discount_expire_date",{expireDate:v}):""}`;return{onRemove:()=>n({appliedPromoCode:null}),price:E,rawPrice:E,title:d,...e.discountedPrice>0?{tooltipTitle:D,tooltipBody:R}:null,variant:"DISCOUNT",onRemoveVisible:l}}var f=()=>{var e="discountCode";return{setDiscountCode:o=>{D.set(e,o,864e5)},getDiscountCode:()=>D.get(e),clearDiscountCode:()=>{D.remove(e)}}},O={__key:0x914b16b5e13b,id:"914b16b5e13b0458b85a224ce2095d7f",loc:{},definitions:[]},x="Acorns",b=(e,o)=>{var r,t,i,n,[{data:s,fetching:a,error:u}]=R({query:O,variables:{discountCode:e},pause:o||!e}),c=null==s||null==(r=s.partnerEntitlement)?void 0:r.partnerName;return{partnerName:c?null==(t=h[c])?void 0:t.altText:void 0,partnerLogo:c?null==(i=h[c])?void 0:i.img:void 0,entitlement:null==s||null==(n=s.partnerEntitlement)?void 0:n.entitlement,error:u,fetching:a}};return e("useDiscountCharge",T),[()=>{P=A,y.useOptimusSubscriptionPrice=l,h={TARGET:{img:"/img2/plus/plus-partner-logo-target.svg",altText:"Target"},ACORNS:{img:"/img2/plus/plus-partner-logo-acorns.svg",altText:x}},e({ACORNS_PARTNER_NAME:x,default:y,useDiscountCharge:T,useDiscountCodePersistance:f,useOptimusEntitlement:b})},[e=>(r=e.useCallback,t=e.useContext,i=e.useEffect),e=>(n=e.default,s=e.BorderlessButton),e=>(a=e.Box,u=e.Stack),e=>c=e.Payment,e=>l=e.useOptimusSubscriptionPrice,e=>(d=e.default,p=e.useLocalize,_=e.useIntlFormatter),e=>m=e.useInteractionLogger,e=>C=e.TextInput,e=>(E=e.jsx,g=e.jsxs,v=e.Fragment),e=>D=e.default,e=>R=e.useQuery]]},["cDcdfi","7yGKf-","SzaY02","ENvJHX","BWm3Dg","0DsHEV","fsml46","7bbexq","F5FCuN","jaCyxS","5X2em-"]]);
