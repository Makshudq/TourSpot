(this.$WP=this.$WP||[]).push(["mT-Pb2",(e,n)=>{"use strict";var o,l,a,r,i,s,t,u,c,d,g,f,m,p,y,C,S,h,v,w,P,b,K,M,I,O,k,L,_,x,B,V,T,N,U,D,E,F,q,A=({onSuccess:e,onClose:n,variant:o,disableClose:l=!1,funnelKey:s,pid:t,requireSecure:u,forceLogin:c,additionalInfo:m})=>{var S=f(),{page:h}=p(),v=y(),w=i(),[P,b]=a(!0),[K,M]=a("splash");return r((()=>{b("splash"===K)}),[K,b]),C(d,{onClose:()=>{n&&n()},onBack:()=>(()=>{var e,n;S({actionType:"click",actionSubType:"OptimusLoginModalClick",itemType:"optimusLoginModalBackButton",team:"Plus",externalKey:s,pageUid:v,itemName:"OptimusLoginModal",page:h});var o=JSON.stringify({action:"back"});null==(e=w.current)||null==(n=e.contentWindow)||n.postMessage(o,"*")})(),hideCloseButton:l,hideBackButton:P,overrideContentStyling:!0,children:C(g,{pid:t,funnelKey:s,onLoginSuccess:()=>{e&&e()},variant:o,requireSecure:u,forceLogin:c,additionalInfo:m,onFlowStepChange:e=>{M(e)},forwardedRef:w})})},G=()=>{var e=P(),{getDiscountCode:n}=K(),o=n(),l=!o,{subscriptionPrice:a,fetching:r}=b(e,o,l,"CHECKOUT");if(r)return null;var i=null==a?void 0:a.trialPeriod;return((null==i?void 0:i.numberOfDays)||0)>0?"testFreeTrial":"test"},R=["OPTIMUS_BRANDED_IMAGE_HIGHLIGHT"],W=({allowClose:e,flow:n,forceLogin:r,useValuePropVariant:i=!0,contextualMessagingVariant:c,contextualMessageKey:d,contextualMessageParamKey:g,contextualMessageParam:f,contextualMessageSubheaderKey:m,isSignInOnly:p,onClose:y,onFailure:S,funnelKey:h,pid:w=40777,additionalInfoOnLoginContent:P,variantOverride:b})=>{var K=v(),{login:M,close:I}=o(),[O,k]=a({onClose:void 0,onSuccess:void 0,funnelKey:void 0,requireSecure:!1}),L=D();b&&(L=b);var _=s((()=>({...c?{}:{contextualMessage:d,contextualMessageParamKey:g,contextualMessageParam:f,contextualMessageSubheader:m},isSignInOnly:p,contextualMessagingVariant:c,funnelKey:h})),[d,f,g,m,c,p,h]),x=R.includes((n||"").toUpperCase()),B=l((()=>L&&"control"!==L?C(U,{variant:L,pid:w,funnelKey:O.funnelKey||h,onClose:O.onClose,onSuccess:O.onSuccess,disableClose:!e,requireSecure:O.requireSecure,forceLogin:O.requireSecure,additionalInfo:P}):null),{},[O]),V=t(void 0),T=u(((n,o)=>K&&!r?Promise.resolve({userId:K,hasCreatedMember:null}):(V.current||(V.current=new Promise((l=>{k({onClose:()=>{e&&(B.close(),V.current=null,y&&y())},onSuccess:()=>{var e={userId:K||null,hasCreatedMember:null};B.close(),n&&n(),V.current=null,l(e)},funnelKey:o,requireSecure:r}),B.open()}))),V.current)),[B,K,k,r,e,y]),N=P&&P.get("email")||"",E=u(((o,l)=>M({flowOrigin:"login",flow:n,isFullWidthMobile:!0,forceLogin:r,requireSecure:r,closeX:e,closeOnDocClick:e,hideBoxShadow:x,extraQueryParams:{..._,funnelKey:l||h,email:N},pid:w,onSuccess:o||void 0,onClose:y,onFailure:S})),[M,n,r,e,x,_,h,w,y,S,N]);return null===L?{login:null,close:()=>{}}:{login:i&&"control"!==L?T:E,close:I}},H=({members:e,nonMembers:n,messageVariant:o,onClose:l,flow:i="OPTIMUS_BRANDED",funnelKey:s,pid:t})=>{var{isWebview:c}=M(),d=v(),g=O(),{login:f}=E({allowClose:!0,forceLogin:!1,...o&&{flow:i,contextualMessagingVariant:o},onClose:l,funnelKey:s,pid:t}),[m,p]=a(!1),{data:y,fetching:C}=I();return r((()=>{(d||c)&&m&&!C&&(p(!1),null!=y&&y.isSubscribed?g(e):g(n))}),[y,C,e,g,n,m,d,c]),u((()=>{d||c?p(!0):f&&f((()=>{p(!0)}))}),[f,p,d,c])},J=()=>{var e=m(),{page:n}=p();return u((({locationId:o,listingKey:l=null,funnelKey:a})=>{if(!o||!a)throw new Error(`Unable to record user login. Missing offer data - ${JSON.stringify({locationId:o,funnelKey:a})}`);e({OptimusOffer:{optimusInitialOfferSignedIn:{servletName:n,locationId:o,funnelKey:a,listingKey:l}}})}),[e,n])},$="PlusHadBlockedCards",j=()=>{var[e,n]=a(!1),[o,l]=a(new Map);return{failedCardPayment:u((a=>{if(a&&!e){var r=o.get(a);r||(r=0),(r+=1)>=5&&(n(!0),L.set($,!0),r=0),l(new Map(o.set(a,r)))}}),[e,n,o]),hasBlockedCardInSession:u((()=>e),[e]),hadBlockedCard:u((()=>!!e||L.has($)),[e]),clearAllBlockedCards:u((()=>{e&&n(!1),L.has($)&&L.remove($)}),[e,n])}},Q=({children:e,forceLogin:n,loginContextualMessageKey:o,shouldLogoutAfterPaymentFailures:l=!1,renderBeforeLogout:i})=>{var{funnelKey:s}=c(k),[t,d]=a(!n),[g,f]=a(!1),m=p(),{failedCardPayment:y,hasBlockedCardInSession:h,hadBlockedCard:w,clearAllBlockedCards:P}=F(),b=w()?"plus_too_many_failed_payments":o,{login:K}=E({allowClose:!1,forceLogin:n,contextualMessageKey:b,funnelKey:s,useValuePropVariant:!w()}),M=v();r((()=>{M&&t||g||!K||(f(!0),K((()=>d(!0))).finally((()=>f(!1))))}),[K,t,g,M]);var I=u((()=>{window.location.href=`/RegistrationController?flow=${encodeURIComponent("SIGN_OUT")}&pid=${encodeURIComponent(String(E))}&returnTo=${encodeURIComponent(m.path)}&fullscreen=true`}),[m.path]),O=l&&h();return r((()=>{O&&I()}),[O,I]),O?i?C(S,{children:i()}):null:M&&t?(P(),C(S,{children:e({userId:M,failedCardPayment:y})})):null},X={__key:30055355565844,id:"1b55cecac7149011bb07b92e7da7355c",loc:{},definitions:[]},Y=e=>!(null==e||!e.canAccessSecureContent),z=()=>{var e=v(),[n,o]=a(null),[l,i]=_({query:X,pause:!e},Y);return r((()=>{e!==n&&(o(e),i())}),[i,n,e]),r((()=>()=>o(null)),[o]),[l,i]},Z=({children:e,contextualMessageKey:n,renderNotSecure:o,skip:l,allowClose:i=!1,onClose:s})=>{var{funnelKey:t}=c(k),{login:u,close:d}=E({allowClose:i,forceLogin:!0,contextualMessageKey:n,funnelKey:t,onClose:s}),[{data:g,fetching:f},m]=q(),[p,y]=a(!1);return r((()=>{g||f||p||l||!u||u((()=>{m(),y(!0)}))}),[g,m,f,u,p,y,l]),r((()=>()=>d()),[d]),g||l?C(S,{children:e()}):o?C(S,{children:o()}):null},ee=({messagingVariant:e,view:n,flow:o,bookingFlow:l,plusBrandedModal:a=!1,onLoginSuccess:r})=>{var{funnelKey:i}=c(k),{page:s}=p(),t=y(),u=T(),d=v(),{login:g}=E({allowClose:!0,funnelKey:i,useValuePropVariant:a}),m=N(),S=f(),P=x((()=>{m({externalKey:i,itemName:"LoginPrompt",itemType:"OptimusGuestCheckout",page:s,pageUid:t,sessionId:u,team:"Plus",userId:d,customData:JSON.stringify({view:n,flow:o,checkoutType:"PAGE",booking_flow:l})})}));return C("div",{ref:P,children:h(V,{variant:"title-05",children:[C(w,"member"===e?{id:"member_login_prompt_already_ta_member"}:{id:"member_login_prompt_already_plus_member"}),C(B,{onClick:()=>{S({actionType:"click",externalKey:i,itemGroup:n,itemName:"LoginPrompt",itemType:"OptimusGuestCheckout",page:s,pageUid:t,sessionId:u,team:"Plus",userId:d,customData:JSON.stringify({checkoutType:"PAGE",view:n,flow:o,loginType:a?"plus":"default",booking_flow:l})}),g&&g(r)},marginLeft:"spacing-01",disabled:null===g,children:C(w,{id:"member_login_prompt_sign_in"})})]})})};return[()=>{U=A,D=G,F=j,q=z,e({MemberLoginPrompt:ee,OptimusHardGate:Q,OptimusSecureLoginGate:Z,useOptimusLogin:E=W,useOptimusLoginNavigation:H,useOptimusLoginTracking:J})},[e=>o=e.default,e=>l=e.useVDOMPortal,e=>(a=e.useState,r=e.useEffect,i=e.createRef,s=e.useMemo,t=e.useRef,u=e.useCallback,c=e.useContext),e=>d=e.ModalContainer,e=>g=e.default,e=>(f=e.useInteractionV3Logger,m=e.useInteractionLogger),e=>(p=e.useRoute,y=e.usePageviewUid),e=>(C=e.jsx,S=e.Fragment,h=e.jsxs),e=>v=e.useUserId,e=>(w=e.default,P=e.useCurrency),e=>b=e.useOptimusSubscriptionPriceQuery,e=>K=e.useDiscountCodePersistance,e=>M=e.useUserAgent,e=>I=e.useOptimusSubscriptionStatusRaw,e=>O=e.useNavigate,e=>k=e.FunnelTracking,e=>L=e.default,e=>_=e.default,e=>x=e.useOnVisible,e=>B=e.BorderlessButton,e=>V=e.default,e=>T=e.useSessionId,e=>N=e.useImpressionV3Logger]]},["VANuRt","vq6MSq","cDcdfi","E1X9WP","gNyFpr","fsml46","F8raOV","F5FCuN","ukkKxE","0DsHEV","BWm3Dg","P89JOf","slAn47","-WwUo-","1yEXVQ","ETqDaL","jaCyxS","kYmwth","PUj9cw","7yGKf-","VP50Wc","VJ7DQx","30t50h"]]);
