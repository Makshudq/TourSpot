(this.$WP=this.$WP||[]).push(["NkmoMN/RV3KHd",(e,t)=>{"use strict";var a,r,n,s,i,o,l,u,c,p,d,g,m,v,h,S,b,k,y,_,f,w,P,I,A,x,E,N,H,T,C,V,D,O,R,F,M,K,L,U,B,G,J,W,j,$,q,Q,z,X,Z,Y,ee=e=>{var{page:t,params:a}=e,r=a.showHighlightOnHR?a.showHighlightOnHR:null;return"Hotel_Review"===t&&1===r},te=(e,t,a)=>{var r={...e.current};r[t]=[...new Set([...r[t]||[],a])],e.current=r},ae=["plus_curated_shopping_interstitial_1648649684"],re="edu_general",ne="edu_hotels",se="edu_experiences",ie="edu_general_p2",oe="edu_hotels_p2",le="edu_experiences_p2",ue="edu_general_p3",ce="edu_hotels_p3",pe="edu_experiences_p3",de=["Attractions","Attraction_Review","AttractionsFusion","AttractionsHome","AttractionsNear","AttractionToursAndTickets"],ge=["Hotels","HotelsHome","HotelsList","HotelsNear","SmartDeals"],me=["Attraction_Products","AttractionProductReview","AttractionProductsFusion","OptimusHotelCheckout","OptimusSubscriptionCheckout","Plus","Restaurant_Review","Restaurants","RestaurantsHome","RestaurantsNear"],ve=["AttractionsHome","Attractions","AttractionsFusion","Hotels","HotelsHome","HotelsList","HotelsNear","SmartDeals"],he="control",Se=e=>F.includes(e),be=["Hotels","Hotel_Review","HotelHighlight","SmartDeals","Tourism"],ke=["Attractions","AttractionsFusion","Attraction_Products","AttractionProductsFusion","AttractionProductReview","Attraction_Review","AttractionsNear"],ye="plus_curated_shopping_interstitial_1648649684",_e=["Hotels","HotelHighlight","SmartDeals","Hotel_Review","ShowUserReviews","Tourism","Attractions","Attraction_Review","Attraction_Products","AttractionProductsFusion","AttractionsFusion","AttractionsNear","ShowForum","ShowTopic","Home"],fe="plus_tiered_test_1649862637",we=(e=!1)=>{var t="DESKTOP"===g(),a=x("Interstitial",e),r="eligible";return t?a||(r="excludedPage"):r="notDesktop",{fetching:!1,eligibility:r}},Pe="plusCuration",Ie=({delayed:e,children:t})=>w(L.Provider,{value:e,children:t}),Ae=e=>{var t="plus-curation"===e,a=r(L),n=O(),s=R(),i={};return t&&(i={geo_id:n,delayed:a}),JSON.stringify({variant:e,isDated:s,...i})},xe=e=>{var t=_(),{funnelKey:a}=r(v),{page:s}=p(),i=d(),o=c(),l=m(),u=B(e);return n((()=>t({externalKey:a,itemName:"Education",itemType:"OptimusMarketingInterstitial",page:s,pageUid:i,sessionId:o,team:"Plus",userId:l,customData:u})),[t,a,s,i,o,l,u])},Ee=e=>{var t=G("plus-curation");return"plus-curation"===e?t:null},Ne="interstitialData",He=e=>e?new Map(JSON.parse(e)):new Map,Te=(e,t,a)=>{var r=He(e).get(t),n=(new Date).getTime();return r&&(null==r?void 0:r.find((e=>e.key===a&&(!e.ttl||e.ttl>=n))))||null},Ce=(e,t,a,r)=>{var n;return((null==(n=Te(e,t,a))?void 0:n.value)||r)+0},Ve=(e,t,a,r)=>{var n,s;return!!(null!=(n=null==(s=Te(e,t,a))?void 0:s.value)?n:r)},De=(e,t,a)=>{var r,n=e.get(t),s=(new Date).getTime();n=(null==(r=n)?void 0:r.filter((e=>e.key!==a.key&&(!e.ttl||e.ttl>=s))))||[];var i=a;return i.ttl&&(i.ttl+=s),n.push(i),e.set(t,n),e},Oe=(e,t,a,r)=>{var n=He(k.get(Ne)||"");De(n,e,{key:t,value:a,ttl:r}),k.set(Ne,JSON.stringify(Array.from(n.entries())))},Re=(e,t,a)=>{var r=He(y.get(Ne)||"");De(r,e,{key:t,value:a}),y.set(Ne,JSON.stringify(Array.from(r.entries())))},Fe=/^https?:\/\/[a-z\-\.0-9]+\.tripadvisor(-preview)?\.[a-z\-\.]+/,Me=()=>s((()=>{var e=document.referrer;return!!e&&!Fe.test(e)}),[]),Ke="pageViews",Le="delayPageViews",Ue="sessionPreviouslySeenCounter",Be="sessionPreviouslySeenGhost",Ge="previouslySeenInterval",Je="previouslySeenTotal",We="previouslySeenIntervalGhost",je="previouslySeenTotalGhost",$e="IneligibilityLogged",qe="interstitialData",Qe=({children:e,onShow:t,onControlWouldShow:a,delaySeconds:n,delayPageViews:u,afterPageViews:g,maxSeen:h,maxSeenSession:S,campaignInfo:b,isDatePickerOpen:P,suppress:I,suppressWhenDelayed:A,ignoreInterval:x,onSkip:E,fallback:N=null,isControl:H=!1})=>{var{campaignName:T,variant:C}=b,V=s((()=>k.get(qe)||""),[]),D=s((()=>y.get(qe)||""),[]),O=s((()=>W.getNumberFromStorage(V,T,Ke,0)),[V,T]),R=s((()=>W.getNumberFromStorage(V,T,Le,0)),[V,T]),F=s((()=>W.getBooleanFromStorage(V,T,Ge,!1)),[V,T]),M=s((()=>W.getNumberFromStorage(V,T,Je,0)),[V,T]),K=s((()=>W.getNumberFromStorage(D,T,Ue,0)),[D,T]),L=s((()=>W.getBooleanFromStorage(V,T,We,!1)),[V,T]),B=s((()=>W.getNumberFromStorage(V,T,je,0)),[V,T]),G=s((()=>W.getNumberFromStorage(D,T,Be,0)),[D,T]),J=i({}),[Q,z]=o(!1),{funnelKey:X}=r(v),{page:Z}=p(),Y=d(),ee=c(),ae=m(),re=f(),ne=_();l((()=>{!x&&F||W.saveValueToLocalStorage(T,Ke,O+1,q)}),[T,O,F,x]);var se=j.useIsExternalReferrer(),ie=!!se&&R<u,oe=I||ie&&A;l((()=>{(oe||P)&&z(!1)}),[oe,P]);var le=s((()=>!P&&O>=g&&(x||!F)&&M<h&&K<S),[P,O,g,F,M,K,h,S,x]);return l((()=>{le&&!oe||!E||E()}),[le,oe,E]),l((()=>{var e=W.getBooleanFromStorage(V,T,$e,!1);if(le){ie&&!A&&W.saveValueToLocalStorage(T,Le,R+1,q);var r=setTimeout((()=>{document.querySelector('[title="regcontroller"]')||document.getElementById("explicitPreferences")||((x||!L)&&G<S&&B<h&&le&&!P&&(re({optimusMarketingInterstitial:{name:H?`control_${C}`:C,pageviewUid:Y}}),H&&(a&&a(),W.saveValueToSessionStorage(T,Be,G+1),W.saveValueToLocalStorage(T,We,!0,$),W.saveValueToLocalStorage(T,je,B+1,q))),oe||!le||P||(W.saveValueToSessionStorage(T,Ue,K+1),W.saveValueToLocalStorage(T,Ge,!0,$),W.saveValueToLocalStorage(T,Je,M+1,q),z(!0),t&&t()))}),ie?1e3*n:0);return()=>clearTimeout(r)}return e||(O<g&&te(J,"common","notEnoughPageViews"),F&&!x&&te(J,"common","seenMaxInterval"),K>=S&&te(J,"common","seenMaxSession"),M>=h&&te(J,"common","seenMaxOverall"),Object.keys(J.current).length>0&&(W.saveValueToLocalStorage(T,$e,!0,$),ne({externalKey:X,itemName:"Ineligibility",itemType:"OptimusMarketingInterstitial",page:Z,pageUid:Y,sessionId:ee,team:"Plus",userId:ae,customData:JSON.stringify({...J.current})}))),()=>{}}),[le,se,z,n,u,R,K,G,M,B,L,h,S,P,t,oe,re,Y,C,H,x,ne,X,Z,ee,ae,J,O,g,F,T,V,ie,a,A]),w(U,{delayed:ie,children:Q?e:N})},ze=e=>{var t=R();return"preDatePicker"===e&&!t},Xe="plusMarketingInterstitial",Ze="edu_general",Ye="edu_hotels",et="edu_experiences",tt="edu_general_p2",at="edu_hotels_p2",rt="edu_experiences_p2",nt="edu_general_p3",st="edu_hotels_p3",it="edu_experiences_p3",ot="shop-vegas-hotels",lt="shop-vegas-experiences",ut="plus-curation",ct="tiered-plus",pt=({delaySeconds:e=30,afterPageViews:t=0,delayPageViews:a=1,maxSeen:s=3,maxSeenSession:u=1,isDatePickerOpen:h,onPopupDismiss:k,onOpen:y,onClose:f,fallback:x=null,popupOrder:T})=>{var R,F,L=i({}),{fetching:U,enabled:B}=b(),[G,W]=o(null),{fetching:j,isEligible:$}=H(),{isOptimusEnabled:q,isOptimusSubscribed:we}=A(!!$),{page:Ie}=p(),Ae=d(),xe=(e=>{var t=(e=>{var t,a=p(),{cashbackEnabled:r}=C(),n=(e=>me.includes(e.page)||(e=>{var{page:t,params:a}=e,r=a.showHighlightOnHR?a.showHighlightOnHR:null;return"Hotel_Review"===t&&1!==r})(e))(a),s=r&&!n;s&&(t="");var{bucket:i,fetching:o}=V(t);return null===r||s&&o?null:o||i?i===he?(te(e,"cashbackAwareness","control"),he):(r||te(e,"cashbackAwareness","cashbackDisabled"),n&&te(e,"cashbackAwareness","excludedPage"),i&&M.includes(i)?"p3"===i?ge.includes(a.page)||ee(a)?ce:de.includes(a.page)?pe:ue:"p2"===i?ge.includes(a.page)||ee(a)?oe:de.includes(a.page)?le:ie:ge.includes(a.page)||ee(a)?ne:de.includes(a.page)?se:re:""):""})(e),a=(e=>{var t="DESKTOP"===g(),a=45963===(p().params.geoId||null),r=D(),n=be.includes(r),s=ke.includes(r),i=n||s,o=I({experimentKeys:[ye]},!(t&&a&&i));if(null===o)return null;if(!t)return te(e,"shopVegas","notDesktop"),"";if(!a||!i)return te(e,"shopVegas","excludedPage"),"";if(null==o||!o[ye])return te(e,"shopVegas","testNotEnabled"),"";if("test"===(null==o?void 0:o[ye])){if(n)return"shop-vegas-hotels";if(s)return"shop-vegas-experiences"}return te(e,"shopVegas","control"),""})(e),r=(e=>{var t="DESKTOP"===g(),a=p(),r=D(),n=45963===(a.params.geoId||null),s=_e.includes(r),i=I({experimentKeys:[fe]},!(t&&!n&&s));return null===i?null:t?s?n?(te(e,"tieredPlus","lasVegasGeo"),""):null!=i&&i[fe]?"control"===(null==i?void 0:i[fe])?(te(e,"tieredPlus","control"),""):s&&"test"===(null==i?void 0:i[fe])?"tiered-plus":"":(te(e,"tieredPlus","testNotEnabled"),""):(te(e,"tieredPlus","excludedPage"),""):(te(e,"tieredPlus","notDesktop"),"")})(e),n=(e=>{var{fetching:t,eligibility:a}=K(!0),r="eligible"!==a,{fetching:n,bucket:s}=E({treatControlAsNull:!1},r),{fetching:i,enabled:o}=S(),l=O(),{fetching:u,data:c}=N(l,"PHASE4",r||null===s||i||o);return t||n||i||u?null:r?(te(e,Pe,a),""):s?null!=c&&c.geoId?o?(te(e,Pe,"notEligibleExpandedCommerceTest"),""):"plus-curation":(te(e,Pe,"notEligibleEntrypointGeo"),""):(te(e,Pe,"notEligibleBucket"),"")})(e);return null===n||null===t||null===a||null===r?null:n?{campaignName:"plusCuration",variant:n}:r?{campaignName:"tieredPlus",variant:r}:a?{campaignName:"shopVegas",variant:a}:t?{campaignName:"cashbackAwareness",variant:t}:{campaignName:"",variant:""}})(L),Ee=(()=>{var{page:e,params:t}=p(),a=t.discountCode||null,r=!("Plus"!==e||!t.autopop&&""!==t.autopop||!a),n="Plus"===e&&null!==t.autopop&&"SUMMER0"===t.autopop;return r||n})(),Ne=(R=null==G?void 0:G.variant,F=p(),Se(R)&&(ve.includes(F.page)||ee(F))),He=(e=>{var{bucket:t}=E({treatControlAsNull:!1},!(e=>"plus-curation"===e)(e));return"control"===t})(null==G?void 0:G.variant),Te=(()=>{var e=m(),t=I({experimentKeys:ae,userId:e||void 0,skipImpression:!0});return null===t?null:Object.keys(t).length>0})(),Ce=_(),{funnelKey:Ve}=r(v),De=c(),Oe=m(),Re="MOBILE"===g();l((()=>{null===G&&W(xe)}),[Ve,Ce,xe,q,we,Ie,Ae,G,De,Oe,j]),l((()=>{null!==G&&(q||te(L,"common","optimusDisabled"),we&&te(L,"common","alreadySubscribed"),Ne&&Re&&te(L,"cashbackAwareness","mobileSupressed"),Te&&Object.keys(L.current).length>0&&Ce({externalKey:Ve,itemName:"Ineligibility",itemType:"OptimusMarketingInterstitial",page:Ie,pageUid:Ae,sessionId:De,team:"Plus",userId:Oe,customData:JSON.stringify({...L.current})}))}),[Ve,Ce,Ne,Te,Re,q,we,Ie,Ae,G,De,Oe]);var Fe=n((()=>{f&&f(),k&&k()}),[f,k]),Me=null===G||null===Te||j||U,Ke=("control"===(null==G?void 0:G.variant)||!q||we||B||!(null!=G&&G.variant))&&!Me;l((()=>{Ke&&k&&k()}),[Ke,k]);var Le=z(T),Ue=J(null==G?void 0:G.variant);if(Me)return null;if(Ke)return w(P,{children:x});var Be=(({variant:e,discountCode:t,onInterstitialClose:a})=>Y.has(e)?(({variant:e,onInterstitialClose:t})=>{var a;switch(e){case Ze:a="earn-general";break;case Ye:a="earn-hotels";break;case et:a="earn-experiences";break;case tt:a="earn-general-p2";break;case at:a="earn-hotels-p2";break;case rt:a="earn-experiences-p2";break;case nt:a="earn-general-p3";break;case st:a="earn-hotels-p3";break;case it:a="earn-experiences-p3";break;case ot:case lt:case ut:case ct:a=e;break;default:throw new Error(`Education interstitial not implemented for variant ${e}`)}return w(Z,{variant:a,onClose:()=>t(),dataAutomationTag:Xe})})({variant:e,onInterstitialClose:a}):(({variant:e,discountCode:t,onInterstitialClose:a})=>{var r,n=null==t?void 0:t.toUpperCase();switch(e){case"not-yet-implemented":r="not-implemented";break;default:throw new Error(`Discount interstitial not implemented for variant ${e}`)}return w(X,{code:n||"25OFF",onClose:()=>a(),variant:r,dataAutomationTag:Xe})})({variant:e,discountCode:t,onInterstitialClose:a}))({variant:G.variant,onInterstitialClose:Fe}),Ge=s,Je=u;return Ee?(Ge=Number.MAX_SAFE_INTEGER,Je=Number.MAX_SAFE_INTEGER):Se(G.variant)&&(Ge=2,Je=1),w(Q,{delaySeconds:e,delayPageViews:Ee?0:a,afterPageViews:t,maxSeen:Ge,maxSeenSession:Je,campaignInfo:G,isDatePickerOpen:h,onSkip:k,ignoreInterval:Ee,onShow:y,onControlWouldShow:Ue,fallback:x,suppress:Ne&&Re||He,suppressWhenDelayed:Le,isControl:He,children:Be})},dt=e=>{var[t]=o(u());return w(h,{funnelKey:t,children:w(pt,{...e})})};return[()=>{F=[se,re,ne,ie,oe,le,ue,ce,pe],M=["p1","p2","p3"],K=we,L=a(!1),U=Ie,B=Ae,G=xe,J=Ee,W={getNumberFromStorage:Ce,getBooleanFromStorage:Ve,saveValueToLocalStorage:Oe,saveValueToSessionStorage:Re},j={useIsExternalReferrer:Me},q=14*($=864e5),Q=Qe,z=ze,X=T.onComponentUsage((()=>t("_MrER3")),"default"),Z=T.onComponentUsage((()=>t("NkmoMN/mRK7tx")),"default"),Y=new Set([Ze,Ye,et,tt,at,rt,nt,st,it,ot,lt,ut,ct]),e({M:dt,a:G,u:B})},[e=>(a=e.createContext,r=e.useContext,n=e.useCallback,s=e.useMemo,i=e.useRef,o=e.useState,l=e.useEffect),e=>u=e.uuid,e=>c=e.useSessionId,e=>(p=e.useRoute,d=e.usePageviewUid),e=>g=e.useViewportCategory,e=>m=e.useUserId,e=>(v=e.FunnelTracking,h=e.FunnelTrackingProvider),e=>(S=e.useHRExpandedCommerce,b=e.useHopperFakeDoorTest),e=>k=e.default,e=>y=e.default,e=>(_=e.useImpressionV3Logger,f=e.useImpressionLogger),e=>(w=e.jsx,P=e.Fragment),e=>I=e.default,e=>A=e.useOptimusEnabledForUser,e=>(x=e.useIsSupportedPage,E=e.usePhase4EntrypointBucket,N=e.useGetEntrypointData,H=e.useIsEligibleEntrypointAnyVersion),e=>T=e,e=>(C=e.useCashbackEnabledRaw,V=e.useExperimentBucket),e=>D=e.default,e=>(O=e.useGeoId,R=e.useIsDated)]]},["cDcdfi","O-HcBE","VJ7DQx","F8raOV","oVKaZR","ukkKxE","ETqDaL","URan46","jaCyxS","qKFflQ","30t50h","F5FCuN","S-RL4Q","v_y45t","sWAkjT","pLbCP4","tVuenP","l16qFs","rAeVJg"]]);
