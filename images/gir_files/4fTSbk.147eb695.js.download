(this.$WP=this.$WP||[]).push(["4fTSbk",(r,t)=>{"use strict";var e,a,i,o,n=1e3,s=(r,t,e,a,i,o,s,l,g)=>new Promise(((c,_)=>{var d,p,u={geoId:r,attractionId:t,partnerName:s,productCode:e,tourGradeCode:a,tourDate:i,passengerMix:(d=o,p={},d.forEach(((r,t)=>{p[t]=r})),p)},m=r=>{fetch(l?"/ShoppingCartApi/cart/add?isCartless=true":"/ShoppingCartApi/cart/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u),credentials:"same-origin"}).then((r=>{if(r.ok)return r;throw Error(r.statusText)})).then((r=>r.json())).then((t=>{if("COMPLETE"!==t.polling_state)"IN_PROGRESS"===t.polling_state&&r<30?setTimeout((()=>m(r+1)),n):_(Error(g.string("attractions.booking.errors.api_error")));else if(t.result)switch(t.result.status){case"SUCCESS":c(t.result);break;case"DUPLICATE_ITEM":_(Error(g.string("attractions.cart.item_already_added_with_link",{0:"/ShoppingCart"})));break;case"ITEM_NOT_AVAILABLE":_(Error(g.string("attractions.cart.alert_not_available")));break;default:_(Error(g.string("attractions.booking.errors.api_error")))}})).catch((()=>{_(Error(g.string("attractions.booking.errors.api_error")))}))};m(1)}));function l(r,t,e){return new Promise(((a,i)=>{var o=s=>{fetch(`/AttractionBookingApi/product/${t?`${t}/`:""}${r}/dates`,{credentials:"same-origin"}).then((r=>{if(r.ok)return r;throw Error(r.statusText)})).then((r=>r.json())).then((r=>{"COMPLETE"!==r.polling_state?"IN_PROGRESS"===r.polling_state&&s<30?setTimeout((()=>o(s+1)),n):i(Error(e.string("attractions.booking.errors.api_error"))):a(r.data)})).catch((()=>{i(Error(e.string("attractions.booking.errors.api_error")))}))};o(1)}))}var g=(r,t)=>{var e,a=1===r.size;return 1===(e=Array.from(r,(r=>((r,t,e,a)=>{if(e)return a.string("attractions.booking.common_n_traveler",{0:t});if(t<1)return"";switch(r){case 1:return a.string("attractions.booking.common_n_adult",{0:t});case 2:return a.string("attractions.booking.common_n_child",{0:t});case 3:return a.string("attractions.booking.common_n_infant",{0:t});case 4:return a.string("attractions.booking.common_n_youth",{0:t});case 5:return a.string("attractions.booking.common_n_senior",{0:t});default:return""}})(r[0],r[1],a,t))).filter((r=>""!==r))).length?e[0]:e.join(", ")},c="DEFAULT",_=r=>{var[t,e,a]=r.split("-").map((r=>parseInt(r,10)));return new Date(t,e-1,a)},d=(r,t,e,a)=>((r,t,e,a)=>{var i=a.formatDate("week_date_long",r),o=g(t,e);return e.string("attractions.booking.tour_grade_unavailable_for_pax_date",{PAX:o,date:i})})(_(r),t,e,a),p=(r,t,e,a)=>d(r,t,e,a);function u(r,t,e,a,i,o,s,l,g,_,p){var u=d(e,a,s,l);return new Promise(((l,d)=>{var m=new URLSearchParams;m.append("tourDate",e),m.append("attrdate",(r=>r.replace(/-/g,"_"))(e)),m.append("ageBands",Array.from(a).map((r=>`${r[0]}:${r[1]}`)).join(",")),g&&m.append("languageServices",g),m.append("locationId",JSON.stringify(o));var b=`/AttractionBookingApi/product/${i?`${i}/`:""}${r}/tour_grades?${m.toString()}`,h=r=>{fetch(b,{credentials:"same-origin"}).then((r=>{if(r.ok)return r;throw Error(r.statusText)})).then((r=>r.json())).then((e=>{if("COMPLETE"===e.polling_state){_&&_();try{var a=e.tour_grades.map((r=>({gradeCode:r.grade_code,sortOrder:r.sort_order,rnplEligibility:{eligible:!!r.rnpl_eligibility&&r.rnpl_eligibility.eligible,ineligibilityReasons:r.rnpl_eligibility?r.rnpl_eligibility.ineligibility_reasons:[]},gradeTitle:c===r.grade_title?t:r.grade_title,gradeDescription:c===r.grade_title?"":r.grade_description,priceFormatted:r.price_formatted,maxTravelersPerUnit:r.max_travelers_per_unit,ageBandsDisplay:r.age_bands.map((r=>r.band_summary)),available:r.available,isMostPopularText:r.is_most_popular_text,langServices:null!==r.lang_services?Object.keys(r.lang_services):null})));a.some((r=>r.available))||(p&&p(),d(Error(u))),l(a)}catch(r){d(Error(s.string("attractions.booking.errors.api_error")))}}else"IN_PROGRESS"===e.polling_state&&r<30?setTimeout((()=>h(r+1)),n):(p&&p(),"NO_LONGER_AVAILABLE"===e.polling_state?d(Error(u)):d(Error(e.error_messages[0])))})).catch((()=>{d(Error(s.string("attractions.booking.errors.api_error")))}))};h(1)}))}var m=r=>o(e,{id:"exp_see_n_experiences_cap",args:{0:r.productCount}});function b(r){var{localize:t}=a(),e=i();return function(a){return o(r,{...a,localize:t,intlFormatter:e})}}return r({getAvailableDates:l,getTourGrades:u,withLocalize:b}),[()=>{r({MAX_PAX_COUNT:15,POLLING_MAX_TRIES:30,POLLING_TIME_OUT:n,addToCart:s,getAvailableDates:l,getCTAKey:m,getLocalDateFromString:_,getPAXText:g,getTourGrades:u,soldOutMessageGated:p,withLocalize:b})},[r=>(e=r.default,a=r.useLocalize,i=r.useIntlFormatter),r=>o=r.jsx]]},["0DsHEV","F5FCuN"]]);
