(this.$WP=this.$WP||[]).push(["HZtvHO",(e,t)=>{"use strict";var a,r,i,n,o,l,s,d,c,p,u,v,T,S,m,C,E,b,I,g,f,h,k,y,_,A,O,M,R,L,P,j,N,w,D,F,x,V=(e,t)=>{var a,r,i;if(!t)return e;var n=(null==(a=e.paginatedTrips)?void 0:a.trips)||[],o=(null==(r=t.paginatedTrips)?void 0:r.trips)||[];return{paginatedTrips:e.paginatedTrips?{trips:[...n,...o],hasMore:!(null==(i=t.paginatedTrips)||!i.hasMore),__typename:e.paginatedTrips.__typename}:t.paginatedTrips,savedTrips:e.savedTrips}},U=e=>{var t;return{__typename:e.__typename,id:e.id||0,title:e.title||void 0,status:e.status||void 0,photoId:e.photoId||void 0,photo:e.photo||{},route:{url:e.route&&e.route.url||void 0},actionPermissions:{canAddItem:!(null==(t=e.actionPermissions)||!t.canAddItem)}}},G=e=>{var t,a,r,i,n,o=(t,a)=>{if(!t||!a)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&a===r.type&&t===String(r.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"},s={offset:0,limit:10,userId:S()||"",reference:l(e),loadSavedTrips:!0},[d,c]=A({query:M,variables:s,combineData:V,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:()=>"invalidateAndRefetch",cloneTrip:()=>"invalidateAndRefetch",tripsDelete:()=>"invalidateAndRefetch",addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>o(e,t),moveTripItem:({variables:{reference:e}})=>o(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveItem:({variables:{reference:e}})=>o(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>o(null==e?void 0:e.id,null==e?void 0:e.type)}}),p=(null==(t=d.data)||null==(a=t.paginatedTrips)?void 0:a.trips)||[],u=p.slice().filter(Boolean).map(U),v=!(null==(r=d.data)||null==(i=r.paginatedTrips)||!i.hasMore),T=(null==(n=d.data)?void 0:n.savedTrips)||[],m=new Set(T.map((e=>null==e?void 0:e.id)).filter(Boolean)),C=v?()=>c({offset:(null==p?void 0:p.length)||0,loadSavedTrips:!1}):()=>Promise.resolve();return{fetching:d.fetching,error:!!d.error,data:{tripList:u,saveSet:m,canMakePublicTrip:!0},hasMore:v,loadMore:C}},W="tvfpI Fn f u j",q="RyNfJ",Q={DEFAULT:e=>R(h,"bundleSave"!==e?{id:"stat_modal_save_to_trip_v2"}:{id:"save_all_items_modal_header"}),CREATE:()=>R(h,{id:"stat_modal_create_a_trip_v2"}),SELECT:()=>R(h,{id:"select_trip_header"}),SELECT_CREATE:()=>R(h,{id:"stat_modal_create_a_trip_v2"})},B=({saveObject:e,overlayState:t,validateTripName:i,lastSavedItem:n,trackingContext:o,trackingSource:l,...d})=>{var c,[p,u]=a.useState(!0),{fetching:v,error:T,data:S,hasMore:m,loadMore:C}=L(e);v?c=R(f,{size:"large"}):T&&(c=R(_,{refetch:C})),a.useEffect((()=>{v||u(!1)}),[]);var[E]=r({source:l||"trips",trackingContext:o,pageAsContext:!0,withSaveSession:!0}),h=()=>{d.onClose(),u(!0)},k=Q[t](e.type),A=R(I,{icon:g,displayType:"LEFT_ALIGN_GRAY",children:k});return R(y,{element:"bundleSave"===e.type?"copyTripModal":"saveTripModal",children:R(b,{header:A,closeIconColor:"BLACK",bodyProps:{isFullBleed:!0},onClose:h,children:c&&p?R("div",{className:W,children:c}):(()=>{var a=n?s(n):void 0,r=()=>R("div",{className:q,children:R(P,{gate:()=>Promise.resolve(),object:e,onMount:()=>{v||T||E({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{d.statCallback("ADD","NEW",e,!0,!0),h()},onError:d.onError,canMakePublicTrip:S.canMakePublicTrip,validateTripName:i,trackingContext:o,trackingSource:l})});switch(t){case"DEFAULT":return 0===S.tripList.length?r():R(N,{tripList:S.tripList,savedSet:S.saveSet,tripListBottom:c,onPaginate:C,hasMore:m,saveObject:e,onMount:()=>{d.preventInteractionInMountedComponents||E({elementClick:{element:"stat"}})},onCreateTrip:()=>{d.onCreateTripClicked&&d.onCreateTripClicked()},tripAction:"SAVE",onRemovedFromTrip:(e,t,a)=>{d.statCallback("REMOVE","EXISTING",e,t,a),h()},onSavedToTrip:(e,t,a)=>{d.statCallback("ADD","EXISTING",e,t,a),h()},onError:d.onError,trackingContext:o,trackingSource:l});case"CREATE":return r();case"SELECT":return a?R(N,{tripList:S.tripList,savedSet:S.saveSet,tripListBottom:c,onPaginate:C,hasMore:m,saveObject:a,onMount:()=>{E({elementClick:{element:"stat"}})},onCreateTrip:()=>{d.onSelectCreateTripClicked&&d.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:(e,t,a)=>{d.statCallback("MOVE","EXISTING",e,t,a),h()},onRemovedFromTrip:(e,t,a)=>{d.statCallback("REMOVE","EXISTING",e,t,a),h()},onError:d.onError,trackingContext:o,trackingSource:l}):"";case"SELECT_CREATE":return n?R("div",{className:q,children:R(j,{gate:()=>Promise.resolve(),item:n,onMovedToCreatedTrip:e=>{d.statCallback("MOVE","NEW",e,!0,!0),h()},canMakePublicTrip:S.canMakePublicTrip})}):r();default:return""}})()})})},H=e=>{},X=(e,t)=>{var a;switch(t.type){case"setOverlayState":return{...e,overlayState:null!=(a=t.state)?a:e.overlayState};case"afterSave":return{...e,overlayState:"DEFAULT",preventInteractionInMountedComponents:!0};default:throw new Error}},z=({allowPopStatModal:e,logInteraction:t,puid:r,object:i,active:o,preventInteractionPropagation:l,trackingContext:s,trackingSource:d,resaveTrip:p,saveObject:u,saveStatus:v,updateLastTripId:T,onClose:E,initialOverlayState:b,...I})=>{var g,f=S(),{launchViewTripToast:h,launchRemoveFromTripToast:k,launchErrorTripToast:y}=c(),{getTripErrorMessage:_}=m(),A=C("SAVE_TO_TRIP_INTENT"),O=C("SAVE_TO_TRIP"),M=C({type:"CREATE_TRIP",payload:{user_id:f||""}}),L=a.useContext(n),[P,j]=a.useReducer(X,{overlayState:b||"DEFAULT",preventInteractionInMountedComponents:!1}),N=a.useRef(!0);a.useEffect((()=>()=>{N.current=!1}),[]);var{onComplete:D}=I,F=a.useCallback((e=>{D&&D(e),L.resetSession()}),[D,L]),x=a.useCallback(((e,a)=>{e&&!a?(h(e,"SAVED",(()=>{t({elementClick:{element:"saved_viewTrip"}})})),F(!0)):a&&(y(a),F(!1)),N.current&&j({type:"setOverlayState",state:"DEFAULT"}),t({elementClick:{element:"unsave_undo"}})}),[h,F,y,t]),V=a.useCallback((e=>{k(e,u,x)}),[k,x,u]),U=a.useCallback((e=>{y(e)}),[y]),[G,W]=a.useState(!1),q=a.useCallback((()=>{W(!0),L.resetSession()}),[L]),Q=a.useCallback(((e,a)=>{"CREATED"===a&&(O(),M()),N.current&&j({type:"afterSave"}),h(e,a,(()=>{t({elementClick:{element:"saved_viewTrip"}})})),T(e.id),F(!0)}),[O,h,F,T,M,t]);return G?null:R("div",{className:"stat_wrapper",onClick:e=>{e.stopPropagation(),e.preventDefault(),!l&&f&&t({elementClick:{element:"item_save",tripId:null==p?void 0:p.id}}),o||A()},children:R(w,{saveObject:u,overlayState:P.overlayState,lastSavedItem:null==(g=v.result)?void 0:g.tripItem,trackingContext:s,trackingSource:d,onCreateTripClicked:()=>{N.current&&j({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:()=>{N.current&&j({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:q,onError:U,preventInteractionInMountedComponents:P.preventInteractionInMountedComponents,statCallback:(e,t,a,r,i)=>{"REMOVE"===e?(V(a),F(i)):"NEW"===t?Q(a,"CREATED"):r&&Q(a,"SAVED")},validateTripName:e=>{if("bundleSave"===u.type&&e.trim().toLowerCase()===i.title.trim().toLowerCase())return _("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})}})})},$=e=>R(i,{children:R(E,{children:R(z,{...e})})}),K=["Profile","HomeFeed","Trips","Home"],J=e=>{var t=a.useMemo((()=>e.saveObject||s(e.object,!0)),[e.saveObject,e.object]),{resaveTrip:i,onComplete:l,allowPopStatModal:d,flowOrigin:S}=e,{isNativeWebview:m,tripId:C,...E}=e,{launchAutoSavedToTripToast:b,launchErrorTripToast:I}=c(),g=p(),{page:f}=g,h=a.useMemo((()=>({source:e.trackingSource||"trips",saveObject:t,trackingContext:e.trackingContext,withSaveSession:!0,pageAsContext:!0})),[e.trackingContext,e.trackingSource,t]),[k,y]=r(h),_=a.useContext(n),[A,O,M]=u(C,t,e.active),L=null==t?void 0:t.id,P=null==t?void 0:t.type,j=a.useCallback((e=>{I(e)}),[I]),N=a.useCallback((()=>{k({elementClick:{element:"ITEM_SAVE_LOGIN",context:f&&o(f)||void 0,puid:y,saveType:P,detailId:L?`${L}`:"",tripId:null==i?void 0:i.id,sessionType:"SAVE",sessionUuid:_.sessionUuid,sessionOrder:_.sessionOrder}})}),[k,f,y,i,L,P,_.sessionOrder,_.sessionUuid]),w=a.useCallback((()=>{k({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:f&&o(f)||void 0,puid:y,saveType:P,detailId:L?`${L}`:"",tripId:null==i?void 0:i.id,sessionType:"SAVE",sessionUuid:_.sessionUuid,sessionOrder:_.sessionOrder}})}),[k,f,y,i,L,P,_.sessionOrder,_.sessionUuid]),F=a.useMemo((()=>({pid:f&&K.includes(g.page)?40439:39766,flow:m?"NATIVE_LOGIN":"SAVES_COMBINED",flowOrigin:S,onLogin:N,onSuccess:w,isFullWidthMobile:!0})),[N,w,f,g.page,m,S]),x=v(F),V=a.useRef(!1),{open:U}=T((()=>t?R(D,{...E,logInteraction:k,puid:y,saveObject:t,saveStatus:A,updateLastTripId:M}):null)),{open:G}=T((()=>t?R(D,{...E,initialOverlayState:"SELECT",logInteraction:k,puid:y,saveObject:t,saveStatus:A,updateLastTripId:M}):null)),W=!!d&&"popStat"in g.params&&g.params.popStat;return a.useEffect((()=>{W&&!V.current&&(V.current=!0,k({elementClick:{element:"autoPopStat"}}),x().then(U))}),[k,x,U,W]),a.useCallback((()=>{x().then((()=>O())).then((([e,t])=>{null!==e||null!==t?t?j({query:"ADD_ITEM_TO_TRIP",tripsError:t}):e&&(b(e,(()=>{G(),k({elementClick:{element:"quickSave_change"}})})),k({modalSuccess:{element:"quickSave",tripId:null==i?void 0:i.id,context:f&&o(f)||void 0,saveType:P,detailId:L?`${L}`:""}}),l&&l(!0)):U()}))}),[U,G,b,k,x,l,j,O,f,i,L,P])},Y=({children:e,...t})=>{var r=a.useMemo((()=>t.saveObject||s(t.object,!0)),[t.saveObject,t.object]),n=F(t);return r?R(i,{children:e(n)}):null},Z=({queryObject:e,children:t,...r})=>{var i,n,o,l,s,d,c,p,u,v,[T,m]=a.useState(null!=(i=r.object)&&null!=(n=i.object)&&n.socialStatistics?!(null==(o=r.object)||null==(l=o.object)||null==(s=l.socialStatistics)||!s.isSaved):!(null==(d=r.object)||null==(c=d.socialStatistics)||!c.isSaved)),C=(t,a)=>{if(!t||!a)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&a===r.type&&t===String(r.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"};v=S()?null!=(null==(p=r.object)||null==(u=p.socialStatistics)?void 0:u.isSaved)?"afterInvalidation":"immediately":"never";var[{fetching:E,data:b,error:I}]=O({query:e.query,variables:e.variables,executeWhen:v},{addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>C(e,t),tripsRemoveItem:({variables:{reference:e}})=>C(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>C(e.id,null==e?void 0:e.type)});return a.useEffect((()=>{if(!E&&!I){var t=b&&b.savesObjects&&b.savesObjects[0];if(t){var{id:a,socialStatistics:r={}}=t,i=(a===e.id||String(a)===e.id)&&!!r.isSaved;i!==T&&m(i)}}}),[E,b,I]),R(x,{active:T,...r,children:e=>t(e,T,E)})},ee=e=>{var t=e.saveObject||s(e.object,!0);if(!t)return console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null;var a=d(t);return a?R(Z,{...e,queryObject:a}):(console.error("Unsupported saves object was passed to QueriedTripFlowSelector"),null)};return[()=>{L=G,P=k.onComponentUsage((()=>t("neHaXV")),"CreateTripWithAddItemModal",R("div",{className:W,children:R(f,{size:"large"})})),j=k.onComponentUsage((()=>t("neHaXV")),"CreateTripWithMoveItemModal",R("div",{className:W,children:R(f,{size:"large"})})),N=k.onComponentUsage((()=>t("pBQaod")),"SaveToTripContent",R("div",{className:W,children:R(f,{size:"large"})})),w=B,z.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1},D=$,F=J,x=Y,ee.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1},e({QueriedTripFlowSelector:ee,TripFlowSelector:x,setSTATDisabledForTesting:H})},[e=>a=e,e=>(r=e.useTripInteraction,i=e.SaveSessionProvider,n=e.SaveSessionTrackingContext,o=e.getInteractionsContext),e=>(l=e.toReference,s=e.toSavesObject,d=e.objectStatisticQuery),e=>c=e.default,e=>p=e.useRoute,e=>u=e.useAutosave,e=>v=e.useSocialLoginGate,e=>T=e.useVDOMPortal,e=>S=e.useUserId,e=>m=e.useLocalizeTripError,e=>C=e.usePixelCallback,e=>E=e.ToastProvider,e=>b=e.default,e=>I=e.TitleBar,e=>g=e.default,e=>f=e.LoadingSpinner,e=>h=e.default,e=>k=e,e=>y=e.TripsImpression,e=>_=e.default,e=>(A=e.usePaginatedQuery,O=e.useInvalidatableQuery),e=>M=e.TripDetailStatQuery,e=>R=e.jsx]]},["cDcdfi","U-DhDC","eFKnUp","PiTJFd","F8raOV","fTyhRT","JFHNGL","vq6MSq","ukkKxE","9I0t-6","jb_4W2","Q7TAd7","O8LbtK","6nM-E7","mhckab","V08PS7","0DsHEV","pLbCP4","c_rvp5","LFeTN6","OnmvvE","RXx5aI","F5FCuN"]]);
